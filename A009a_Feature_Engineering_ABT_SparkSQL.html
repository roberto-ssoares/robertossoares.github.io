<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>A009a_Feature_Engineering_ABT_SparkSQL</title>
<style>
        /* Estilo básico para o notebook exportado */
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }

        h1, h2, h3 {
            color: #333;
        }

        .output {
            background-color: #ECECEC;
            border-left: 5px solid #ccc;
            padding: 10px;
            margin: 10px 0;
            color: #171c81; /* Cor do texto do código */
        }

        .code_cell {
            background-color: #fdf0f0; /* Fundo cinza claro */
            border: 2px solid #e0e0e0; /* Borda clara */
            padding: 10px;
            margin: 10px 0;
            color: #333333; /* Cor do texto do código */
        }

        pre {
            background-color: #f7f7f7; /* Fundo cinza claro */
            /*color: #333333; Texto em cinza escuro */
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            margin: 10px 0; /* Remove margens adicionais */        
            }

        .output_png {
            text-align: center;
        }

        .cell {
            margin-bottom: 20px;
            color: #171c81; /* Cor do texto do código */
        }

        .anchor-link {
            display: none; /* Remover a exibição do símbolo ¶ */
        }

        h1 {
            font-size: 24px; /* Diminui o tamanho da fonte */
            font-family: 'Segoe Print', Segoe, Print; /* Altera a fonte para Times New Roman */
            color: #686f87; /* Cor opcional */
        }
</style>

</head>
<body>
<h1>A009a_Feature_Engineering_ABT_SparkSQL</h1>
<div class="cell">
<div style="background-color:#F3F2EE">
<h1 id=""><a class="anchor-link" href="#">¶</a></h1><p style="text-align: center;">
<font color="#0A1781" face="Segoe Script" size="6">
<strong>
        PoD Academy<br \=""/>Formação Full Stack Data &amp; Analytics
    </strong>
</font>
</p>
<p style="text-align: center;">
<font color="#C58A1E" face="Segoe Script" size="6.5">
<strong>Aula A009 - Feature Engineering com SPARK-SQL<br \=""/>Montando uma ABT (Analitical Base Table)
</strong></font>
</p>
<h1 id=""><a class="anchor-link" href="#">¶</a></h1></div>
</div>
<div class="cell">
<div style="background-color:#F4F4F4">
<p style="text-align: right;">
<font color="#444444" face="Segoe Script" size="4">
    Roberto Soares - LfLngLrnng
  </font>
</p>
<p style="text-align: right;"><font color="#444444" face="Segoe Print" size="2">
<a href="https://www.linkedin.com/in/roberto-dos-santos-soares/">in/roberto-dos-santos-soares</a>
<p style="text-align: right;"><font color="#444444" face="Segoe Print" size="2">
<a href="https://github.com/roberto-ssoares/roberto-ssoares.github.io">Portifólio: roberto-ssoares</a>
<p style="text-align: right;">
<font color="#444444" face="Segoe Script" size="3">
    PoD Academy - Prof. Bruno Jardim<br \=""/>[+] Faturamento,<br \=""/> [-] Custo,<br \=""/> [+] Qualidade de vida  
  </font>
</p>
</font></p></font></p></div>
</div>
<div class="cell">
<div style="background-color:#F3F2EE">
<p><font color="#CC403E" face="Segoe Print" size="4"><strong>Neste notebook vamos aprender a:</strong></font></p>
<font color="#66666" face="Segoe Print" size="3">
<ul>
<li>Ler dados com spark</li>
<li>Habilitar uso do Spark.SQL</li>
<li>Criar variáveis explicativas para Machine Learning</li>
<li>Montar uma Tabela Analítica de Modelagem (ABT)</li>
<li>Gerar amostra para estudos e modelagem</li>
<li>Salvar dados</li>
</ul>
</font></div>
<div class="cell">
<div style="background-color:#EBE7E1">
<p><font color="#FF5733" face="Segoe Print" size="4">Instalando e Carregando Pacotes</font></p>
<td>
<font color="#66666" face="Segoe Print" size="2">
<p>Para atualizar um pacote, execute o comando abaixo no terminal ou prompt de comando:</p>
<ul>
<li>pip install -U nome_pacote</li>
</ul>
<p>Para instalar a versão exata de um pacote, execute o comando abaixo no terminal ou prompt de comando:</p>
<ul>
<li>!pip install nome_pacote==versão_desejada</li>
</ul>
<p>Depois de instalar ou atualizar o pacote, reinicie o jupyter notebook.</p>
</font>
</td>
</div>
<div class="cell">
<div style="background-color:#EBE7E1">
<p><font color="#FF5733" face="Segoe Print" size="3">Instala o pacote watermark</font></p>
<font color="#66666" face="Segoe Print" size="2">
<ul>
<li>Esse pacote é usado para gravar as versões de outros pacotes usados neste jupyter notebook.</li>
</ul>
</font></div>
<div class="cell">
<div class="code_cell">
<pre>#!pip install -q -U watermark</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#EBE7E1">
<h2 id="Configura%C3%A7%C3%A3o-do-ambiente-para-utiliza%C3%A7%C3%A3o-do-Spark"><font color="#CC403E" face="Segoe Print" size="5"><strong>Configuração do ambiente para utilização do Spark</strong></font><a class="anchor-link" href="#Configura%C3%A7%C3%A3o-do-ambiente-para-utiliza%C3%A7%C3%A3o-do-Spark">¶</a></h2><font color="#66666" face="Segoe Print" size="3">
</font></div>
<div class="cell">
<div style="background-color:#EBE7E1">
<p><font color="#FF5733" face="Segoe Print" size="3">Instalação:</font></p>
<font color="#66666" face="Segoe Print" size="2">
<ul>
<li>Depois de criar um novo notebook no <strong>Google Colab</strong>,</li>
<li>É preciso instalar JAVA, Spark, findspark lib.</li>
<li>A seguir estão as etapas para fazer isso</li>
</ul>
</font></div>
<div class="cell">
<div class="code_cell">
<pre>#!apt-get install openjdk-8-jdk-headless -qq &gt; /dev/null
#!wget -q https://archive.apache.org/dist/spark/spark-3.1.2/spark-3.1.2-bin-hadoop3.2.tgz
#!tar xf spark-3.1.2-bin-hadoop3.2.tgz</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>#import os
#os.environ["JAVA_HOME"] = "/usr/lib/jvm/java-8-openjdk-amd64"
#os.environ["SPARK_HOME"] = "/content/spark-3.1.2-bin-hadoop3.2"</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>#import os
#os.environ['HADOOP_HOME'] = 'C:\\hadoop'
#os.environ['JAVA_HOME'] = 'C:\\Path\\To\\Java'
#os.environ['PATH'] += ';C:\\hadoop\\bin'</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#EBE7E1">
<p><font color="#FF5733" face="Segoe Print" size="3">Instala o pacote findspark:</font></p>
<font color="#66666" face="Segoe Print" size="2">
<ul>
<li>Precisamos instalar o findspark e inicializá-lo.</li>
<li>findpsark lib irá localizar o spark no sistema e importar a biblioteca para você inicializar o contexto do spark</li>
</ul>
</font></div>
<div class="cell">
<div class="code_cell">
<pre>#!pip install -q findspark</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#EBE7E1">
<p><font color="#FF5733" face="Segoe Print" size="3"><strong>Ambiente Spark Local - Construindo SparkSession:</strong></font></p>
<font color="#66666" face="Segoe Print" size="3">
</font></div>
<div class="cell">
<div class="code_cell">
<pre>import os
os.environ['PYSPARK_PYTHON'] = r'D:\anaconda3\envs\spark-pod-env\python.exe'
                                
import pyspark

from pyspark import SparkContext, SparkConf
from pyspark.sql import SparkSession

conf = pyspark.SparkConf() \
    .setAppName('A009-FEATURE-ENGINEERING-ABT') \
    .setMaster('local')

sc = pyspark.SparkContext(conf=conf)

spark = SparkSession(sc)</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>spark</pre>
</div>
<div class="output">
<div>
<p><b>SparkSession - in-memory</b></p>
<div>
<p><b>SparkContext</b></p>
<p><a href="http://PC-ROBERTO:4040">Spark UI</a></p>
<dl>
<dt>Version</dt>
<dd><code>v3.5.2</code></dd>
<dt>Master</dt>
<dd><code>local</code></dd>
<dt>AppName</dt>
<dd><code>A009-FEATURE-ENGINEERING-ABT</code></dd>
</dl>
</div>
</div>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre># Versões dos pacotes usados neste jupyter notebook
%reload_ext watermark
%watermark -a "Roberto Soares - LfLngLrnng"</pre>
</div>
<div class="output">
<pre>Author: Roberto Soares - LfLngLrnng

</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#F3F2EE">
<h2 id="CRISP-DM-(Data-Understanding)"><font color="#CC403E" face="Segoe Print" size="5"><strong>CRISP-DM (Data Understanding)</strong></font><a class="anchor-link" href="#CRISP-DM-(Data-Understanding)">¶</a></h2><font color="#66666" face="Segoe Print" size="3">
</font></div>
<div class="cell">
<div style="background-color:#F3F2EE">
<h2 id="1.-Lendo-dados-com-Spark"><font color="#CC403E" face="Segoe Print" size="4"><strong>1. Lendo dados com Spark</strong></font><a class="anchor-link" href="#1.-Lendo-dados-com-Spark">¶</a></h2><font color="#66666" face="Segoe Print" size="3">
</font></div>
<div class="cell">
<div class="code_cell">
<pre>caminho = "D:/_jupyter/pod/ds/mod06-ciencia-de-dados/data/"
base_transacoes = "base_transacoes.csv"
base_churn = "base_churn.csv"</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>df_transacoes = spark.read.csv(caminho+base_transacoes,
                               header=True,
                               inferSchema=True
                              )</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>df_publico = spark.read.csv(caminho+base_churn, 
                            header=True, 
                            inferSchema=True
                           )</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>print("Base de Público - Um registro por cliente")
print(df_publico.show(5))
print()
print("Base de Transações - Muitos registros por de transações por cliente")
print(df_transacoes.show(5,False))</pre>
</div>
<div class="output">
<pre>Base de Público - Um registro por cliente
+---+-----+------+----------------------+------------+-------------+-----+
| ID|Idade|Gênero|Dias desde a Inscrição|Usou Suporte|        Plano|Churn|
+---+-----+------+----------------------+------------+-------------+-----+
|  1|   21|     F|                  1331|           1|Intermediário|    1|
|  2|   21|     M|                  1160|           0|Intermediário|    0|
|  3|   62|     M|                   454|           1|       Básico|    0|
|  4|   64|     M|                   226|           1|Intermediário|    0|
|  5|   61|     M|                   474|           1|     Avançado|    0|
+---+-----+------+----------------------+------------+-------------+-----+
only showing top 5 rows

None

Base de Transações - Muitos registros por de transações por cliente
+------------+----------+--------------------------+------------------+-----------+
|ID Transação|ID Cliente|Data                      |Valor             |Categoria  |
+------------+----------+--------------------------+------------------+-----------+
|1           |1         |2022-11-25 13:50:26.548672|57.287427536330505|Esportes   |
|2           |1         |2020-01-19 12:27:36.637168|97.07199340552512 |Alimentos  |
|3           |1         |2021-12-28 12:33:58.938053|169.10581012381087|Livros     |
|4           |1         |2022-02-05 01:39:49.38053 |199.38694865538451|Roupas     |
|5           |1         |2022-11-16 23:06:54.159292|160.00228343317622|Eletrônicos|
+------------+----------+--------------------------+------------------+-----------+
only showing top 5 rows

None
</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#EBE7E1">
<p><font color="#FF5733" face="Segoe Print" size="3"><strong>Mostrar o Schema da tabela - (df_publico, df_transacoes):</strong></font></p>
<font color="#66666" face="Segoe Print" size="3">
</font></div>
<div class="cell">
<div class="code_cell">
<pre>print("Base de Público")
print(df_publico.printSchema())
print()
print("Base de Transações")
print(df_transacoes.printSchema())</pre>
</div>
<div class="output">
<pre>Base de Público
root
 |-- ID: integer (nullable = true)
 |-- Idade: integer (nullable = true)
 |-- Gênero: string (nullable = true)
 |-- Dias desde a Inscrição: integer (nullable = true)
 |-- Usou Suporte: integer (nullable = true)
 |-- Plano: string (nullable = true)
 |-- Churn: integer (nullable = true)

None

Base de Transações
root
 |-- ID Transação: integer (nullable = true)
 |-- ID Cliente: integer (nullable = true)
 |-- Data: timestamp (nullable = true)
 |-- Valor: double (nullable = true)
 |-- Categoria: string (nullable = true)

None
</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#EBE7E1">
<p><font color="#FF5733" face="Segoe Print" size="3"><strong>Observações:</strong></font></p>
<font color="#66666" face="Segoe Print" size="3">
<ul>
<li>Visualizamos um formato que pode dar trabalho mais a frente, exemplo: a variável "ID Transação", tem espaço entre as palavras, bem como, cedilha e acentuação.</li>
<li>Devemos padronizar o nome das variáveis</li>
</ul>
</font></div>
<div class="cell">
<div style="background-color:#EBE7E1">
<p><font color="#FF5733" face="Segoe Print" size="4"><strong>Função para padronizar no nome das variáveis:</strong></font></p>
<font color="#66666" face="Segoe Print" size="2.5">
<p>O código apresentado tem o objetivo de padronizar os nomes das colunas de um DataFrame do PySpark.</p>
<p>A padronização inclui:</p>
<ul>
<li><strong>Remoção de Acentos e Cedilhas:</strong> Utilizando a função <strong>"unicodedata.normalize"</strong> para transformar caracteres acentuados em seus equivalentes sem acento,<br>seguido por encode e decode para remover caracteres não ASCII.</br></li>
<li><strong>Transformação para Caixa Alta:</strong> Converte todos os caracteres para maiúsculas.</li>
<li><strong>Substituição de Espaços por Underscores:</strong> Transforma espaços em underscores (_) para conformidade com práticas comuns de nomes de colunas.</li>
</ul>
<p><a href="https://docs.python.org/3/library/unicodedata.html">https://docs.python.org/3/library/unicodedata.html</a></p>
</font></div>
<div class="cell">
<div class="code_cell">
<pre>import unicodedata
from pyspark.sql import DataFrame

def remover_acentuacao_e_formatar(nome_coluna: str) -&gt; str:
    """
    Remove acentuação, transforma cedilhas e converte espaços para underscores.
    Transforma a string para caixa alta.
    """
    # Remove acentuação e caracteres não-ASCII
    nome_sem_acentuacao = unicodedata.normalize('NFKD', nome_coluna).encode('ASCII', 'ignore').decode('ASCII')
    # Substitui espaços por underscores e converte para maiúsculas
    nome_padronizado = nome_sem_acentuacao.replace(" ", "_").upper()
    return nome_padronizado

def padronizar_nomes_colunas(dataframe: DataFrame) -&gt; DataFrame:
    """
    Padroniza os nomes das colunas de um DataFrame PySpark removendo acentuações,
    substituindo espaços por underscores e convertendo para caixa alta.
    """
    # Renomeia as colunas do DataFrame utilizando a função de padronização
    novas_colunas = [remover_acentuacao_e_formatar(coluna) for coluna in dataframe.columns]
    dataframe_padronizado = dataframe.toDF(*novas_colunas)
    
    return dataframe_padronizado</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#EBE7E1">
<p><font color="#FF5733" face="Segoe Print" size="3"><strong>Aplicando a padronização do nome das variáveis em df_publico:</strong></font></p>
<font color="#66666" face="Segoe Print" size="3">
</font></div>
<div class="cell">
<div class="code_cell">
<pre># Exemplo de uso:
df_publico = padronizar_nomes_colunas(df_publico)
df_publico.printSchema()</pre>
</div>
<div class="output">
<pre>root
 |-- ID: integer (nullable = true)
 |-- IDADE: integer (nullable = true)
 |-- GENERO: string (nullable = true)
 |-- DIAS_DESDE_A_INSCRICAO: integer (nullable = true)
 |-- USOU_SUPORTE: integer (nullable = true)
 |-- PLANO: string (nullable = true)
 |-- CHURN: integer (nullable = true)

</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#EBE7E1">
<p><font color="#FF5733" face="Segoe Print" size="3"><strong>Verificando se há valores nulos em df_transacoes:</strong></font></p>
<font color="#66666" face="Segoe Print" size="2.5">
<p>Esse código em PySpark é usado para contar o número de valores nulos em cada coluna de um DataFrame.</p>
</font></div>
<div class="cell">
<div class="code_cell">
<pre>from pyspark.sql.functions import *
df_publico.select([count(when(isnull(c), c)).alias(c) for c in df_publico.columns]).show()</pre>
</div>
<div class="output">
<pre>+---+-----+------+----------------------+------------+-----+-----+
| ID|IDADE|GENERO|DIAS_DESDE_A_INSCRICAO|USOU_SUPORTE|PLANO|CHURN|
+---+-----+------+----------------------+------------+-----+-----+
|  0|    0|     0|                     0|           0|    0|    0|
+---+-----+------+----------------------+------------+-----+-----+

</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#EBE7E1">
<p><font color="#FF5733" face="Segoe Print" size="3"><strong>Observações:</strong></font></p>
<font color="#66666" face="Segoe Print" size="2">
<ul>
<li>Na verificação de valores nulos, não encontramos nenhuma ocorrência</li>
</ul>
</font></div>
<div class="cell">
<div style="background-color:#EBE7E1">
<p><font color="#FF5733" face="Segoe Print" size="3"><strong>Criando uma tabela temporária - sql_publico:</strong></font></p>
<font color="#66666" face="Segoe Print" size="3">
</font></div>
<div class="cell">
<div class="code_cell">
<pre>df_publico.createOrReplaceTempView("sql_publico")</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#EBE7E1">
<p><font color="#FF5733" face="Segoe Print" size="3"><strong>Aplicando a padronização do nome das variáveis em df_transacoes:</strong></font></p>
<font color="#66666" face="Segoe Print" size="3">
</font></div>
<div class="cell">
<div class="code_cell">
<pre># Exemplo de uso:
df_transacoes = padronizar_nomes_colunas(df_transacoes)
df_transacoes.printSchema()</pre>
</div>
<div class="output">
<pre>root
 |-- ID_TRANSACAO: integer (nullable = true)
 |-- ID_CLIENTE: integer (nullable = true)
 |-- DATA: timestamp (nullable = true)
 |-- VALOR: double (nullable = true)
 |-- CATEGORIA: string (nullable = true)

</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#EBE7E1">
<p><font color="#FF5733" face="Segoe Print" size="3"><strong>Verificando se há valores nulos em df_transacoes:</strong></font></p>
<font color="#66666" face="Segoe Print" size="2.5">
<p>Esse código em PySpark é usado para contar o número de valores nulos em cada coluna de um DataFrame.</p>
</font></div>
<div class="cell">
<div class="code_cell">
<pre>from pyspark.sql.functions import *
df_transacoes.select([count(when(isnull(c), c)).alias(c) for c in df_transacoes.columns]).show()</pre>
</div>
<div class="output">
<pre>+------------+----------+----+-----+---------+
|ID_TRANSACAO|ID_CLIENTE|DATA|VALOR|CATEGORIA|
+------------+----------+----+-----+---------+
|           0|         0|   0|    0|        0|
+------------+----------+----+-----+---------+

</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#EBE7E1">
<p><font color="#FF5733" face="Segoe Print" size="3"><strong>Observações:</strong></font></p>
<font color="#66666" face="Segoe Print" size="2.5">
<ul>
<li>Muitas transações por cliente, onde deveremos agrupar para o grão "ID_CLIENTE"</li>
<li>Na verificação de valores nulos, não encontramos nenhuma ocorrência</li>
</ul>
</font></div>
<div class="cell">
<div style="background-color:#EBE7E1">
<p><font color="#FF5733" face="Segoe Print" size="3"><strong>Criando uma tabela temporária - sql_trancacoes:</strong></font></p>
<font color="#66666" face="Segoe Print" size="3">
</font></div>
<div class="cell">
<div class="code_cell">
<pre>df_transacoes.createOrReplaceTempView("sql_transacoes")</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#EBE7E1">
<p><font color="#FF5733" face="Segoe Print" size="4"><strong>Função de Metadados:</strong></font></p>
<font color="#66666" face="Segoe Print" size="2.5">
<p>Você pode gerar um DataFrame de metadados utilizando Spark SQL. Abaixo está a função equivalente que gera o mesmo resultado usando SQL em PySpark:</p>
<p><strong>Explicação:</strong></p>
<ol>
<li><strong>dataframe.createOrReplaceTempView("tabela"):</strong></li>
</ol>
<ul>
<li>Cria uma tabela temporária chamada "tabela" a partir do DataFrame fornecido.</li>
<li>Isso permite que você execute consultas SQL diretamente na tabela.</li>
</ul>
<ol start="2">
<li><strong>sql_query:</strong></li>
</ol>
<ul>
<li>Esta string SQL constrói uma consulta para calcular os metadados de cada coluna.</li>
<li>O SQL usa subconsultas para calcular:<ul>
<li><strong>Nome da coluna ("coluna")</strong>: Nome da variável.</li>
<li><strong>Tipo de dados ("tipo")</strong>: Tipo da coluna.</li>
<li><strong>Quantidade de nulos ("qt_nulos")</strong>: Contagem de valores nulos.</li>
<li><strong>Percentual de nulos ("percent_nulos")</strong>: Percentual de valores nulos em relação ao número total de linhas.</li>
<li><strong>Cardinalidade ("cardinalidade")</strong>: Número de valores distintos.</li>
</ul>
</li>
</ul>
<ol start="3">
<li><strong>spark.sql(sql_query):</strong></li>
</ol>
<ul>
<li>Executa a consulta SQL construída e retorna o DataFrame resultante.</li>
</ul>
<p><strong>Observação:</strong></p>
<ul>
<li>A consulta SQL construída na função usa as colunas do DataFrame para gerar as respectivas estatísticas.</li>
<li>Esse código SQL é um exemplo geral, e pode ser necessário ajustá-lo dependendo das particularidades do schema do DataFrame e da compatibilidade das funções SQL com o Spark.</li>
</ul>
</font></div>
<div class="cell">
<div class="code_cell">
<pre>from pyspark.sql.functions import expr

def gerar_metadados_sql(table_name: str):

    # Obtendo as colunas e seus tipos
    dataframe = spark.table(table_name)
    colunas = dataframe.columns
    tipos = [str(dataframe.schema[col].dataType) for col in colunas]

    # Lista para armazenar o resultado de cada coluna
    metadados_list = []

    # Iterando sobre cada coluna para gerar os metadados
    for col, dtype in zip(colunas, tipos):
        sql_query = f"""
        SELECT
            '{table_name}' AS nome_tabela,
            '{col}' AS nome_variavel,
            '{dtype}' AS tipo,
            COUNT(*) AS total_linhas,
            COUNT(CASE WHEN `{col}` IS NULL THEN 1 END) AS qt_nulos,
            COUNT(DISTINCT `{col}`) AS cardinalidade,
            (COUNT(CASE WHEN `{col}` IS NULL THEN 1 END) / COUNT(*)) * 100 AS percent_nulos
        FROM
            {table_name}
        """

        # Executando a consulta SQL para cada coluna e coletando o resultado
        metadados_df = spark.sql(sql_query)
        metadados_list.append(metadados_df)

    # Unindo os resultados de todas as colunas
    final_metadados_df = metadados_list[0]
    for df in metadados_list[1:]:
        final_metadados_df = final_metadados_df.union(df)

    return final_metadados_df</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#F3F2EE">
<h2 id="Metadados---sql_publico:"><font color="#CC403E" face="Segoe Print" size="3"><strong>Metadados - sql_publico:</strong></font><a class="anchor-link" href="#Metadados---sql_publico:">¶</a></h2><font color="#66666" face="Segoe Print" size="3">
</font></div>
<div class="cell">
<div class="code_cell">
<pre>metadados_publico = gerar_metadados_sql("sql_publico")
metadados_publico.show(truncate=False)</pre>
</div>
<div class="output">
<pre>+-----------+----------------------+-------------+------------+--------+-------------+-------------+
|nome_tabela|nome_variavel         |tipo         |total_linhas|qt_nulos|cardinalidade|percent_nulos|
+-----------+----------------------+-------------+------------+--------+-------------+-------------+
|sql_publico|ID                    |IntegerType()|1000        |0       |1000         |0.0          |
|sql_publico|IDADE                 |IntegerType()|1000        |0       |52           |0.0          |
|sql_publico|GENERO                |StringType() |1000        |0       |2            |0.0          |
|sql_publico|DIAS_DESDE_A_INSCRICAO|IntegerType()|1000        |0       |773          |0.0          |
|sql_publico|USOU_SUPORTE          |IntegerType()|1000        |0       |2            |0.0          |
|sql_publico|PLANO                 |StringType() |1000        |0       |3            |0.0          |
|sql_publico|CHURN                 |IntegerType()|1000        |0       |2            |0.0          |
+-----------+----------------------+-------------+------------+--------+-------------+-------------+

</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#F3F2EE">
<h2 id="Metadados---sql_transacoes:"><font color="#CC403E" face="Segoe Print" size="3"><strong>Metadados - sql_transacoes:</strong></font><a class="anchor-link" href="#Metadados---sql_transacoes:">¶</a></h2><font color="#66666" face="Segoe Print" size="3">
</font></div>
<div class="cell">
<div class="code_cell">
<pre>metadados_transacoes = gerar_metadados_sql("sql_transacoes")
metadados_transacoes.show(truncate=False)</pre>
</div>
<div class="output">
<pre>+--------------+-------------+---------------+------------+--------+-------------+-------------+
|nome_tabela   |nome_variavel|tipo           |total_linhas|qt_nulos|cardinalidade|percent_nulos|
+--------------+-------------+---------------+------------+--------+-------------+-------------+
|sql_transacoes|ID_TRANSACAO |IntegerType()  |10171       |0       |10171        |0.0          |
|sql_transacoes|ID_CLIENTE   |IntegerType()  |10171       |0       |1000         |0.0          |
|sql_transacoes|DATA         |TimestampType()|10171       |0       |10171        |0.0          |
|sql_transacoes|VALOR        |DoubleType()   |10171       |0       |10171        |0.0          |
|sql_transacoes|CATEGORIA    |StringType()   |10171       |0       |5            |0.0          |
+--------------+-------------+---------------+------------+--------+-------------+-------------+

</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#F3F2EE">
<h2 id="CRISP-DM-(Data-Preparation)---Feature-Engineering"><font color="#CC403E" face="Segoe Print" size="5"><strong>CRISP-DM (Data Preparation) - Feature Engineering</strong></font><a class="anchor-link" href="#CRISP-DM-(Data-Preparation)---Feature-Engineering">¶</a></h2><font color="#66666" face="Segoe Print" size="3">
</font></div>
<div class="cell">
<div style="background-color:#F3F2EE">
<h2 id="Criando-flags-de-janela-para-hist%C3%B3rico:"><font color="#CC403E" face="Segoe Print" size="4"><strong>Criando flags de janela para histórico:</strong></font><a class="anchor-link" href="#Criando-flags-de-janela-para-hist%C3%B3rico:">¶</a></h2><font color="#66666" face="Segoe Print" size="3">
<ul>
<li>últimos 3 meses</li>
<li>últimos 6 meses</li>
<li>últimos 12 meses</li>
</ul>
<p>As Flags irão auxiliar na criação da variaveis explicativas</p>
</font></div>
<div class="cell">
<div class="code_cell">
<pre>dfqry01 = spark.sql("""
SELECT
*,
DATA,
CASE WHEN DATA BETWEEN DATE_ADD(MAX(DATA) OVER (PARTITION BY ID_CLIENTE),  -90) AND MAX(DATA) OVER (PARTITION BY ID_CLIENTE) THEN 1 ELSE 0 END AS FLG_U03M,
CASE WHEN DATA BETWEEN DATE_ADD(MAX(DATA) OVER (PARTITION BY ID_CLIENTE), -180) AND MAX(DATA) OVER (PARTITION BY ID_CLIENTE) THEN 1 ELSE 0 END AS FLG_U06M,
CASE WHEN DATA BETWEEN DATE_ADD(MAX(DATA) OVER (PARTITION BY ID_CLIENTE), -365) AND MAX(DATA) OVER (PARTITION BY ID_CLIENTE) THEN 1 ELSE 0 END AS FLG_U12M
FROM sql_transacoes
ORDER BY ID_CLIENTE, DATA;
""")
dfqry01.createOrReplaceTempView("tmpview01")</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>print("Teste de sanidade (valida volumetria) - total de registros na base transacoes")
print(dfqry01.count())
print()
print(dfqry01.show(3,False))</pre>
</div>
<div class="output">
<pre>Teste de sanidade (valida volumetria) - total de registros na base transacoes
10171

+------------+----------+--------------------------+------------------+---------+--------------------------+--------+--------+--------+
|ID_TRANSACAO|ID_CLIENTE|DATA                      |VALOR             |CATEGORIA|DATA                      |FLG_U03M|FLG_U06M|FLG_U12M|
+------------+----------+--------------------------+------------------+---------+--------------------------+--------+--------+--------+
|2           |1         |2020-01-19 12:27:36.637168|97.07199340552512 |Alimentos|2020-01-19 12:27:36.637168|0       |0       |0       |
|6           |1         |2020-04-25 12:42:28.672566|9.842481270765422 |Alimentos|2020-04-25 12:42:28.672566|0       |0       |0       |
|10          |1         |2020-09-06 21:37:41.946902|56.524638713138636|Alimentos|2020-09-06 21:37:41.946902|0       |0       |0       |
+------------+----------+--------------------------+------------------+---------+--------------------------+--------+--------+--------+
only showing top 3 rows

None
</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#F3F2EE">
<h2 id="Criando-vari%C3%A1veis-explicativas-de-%22Primeira-Camada%22"><font color="#CC403E" face="Segoe Print" size="3"><strong>Criando variáveis explicativas de "Primeira Camada"</strong></font><a class="anchor-link" href="#Criando-vari%C3%A1veis-explicativas-de-%22Primeira-Camada%22">¶</a></h2><font color="#66666" face="Segoe Print" size="2">
<p>Apenas algumas variáveis foram criadas, a sugestão é criar muito mais:</p>
<ul>
<li>use média, mínimo, soma, máximo</li>
<li>use os outros tipos de consumo</li>
</ul>
</font></div>
<div class="cell">
<div class="code_cell">
<pre>spark.sql("""SELECT CATEGORIA, COUNT(*) AS QT_TRANSACOES FROM sql_transacoes GROUP BY CATEGORIA;""").show()</pre>
</div>
<div class="output">
<pre>+-----------+-------------+
|  CATEGORIA|QT_TRANSACOES|
+-----------+-------------+
|     Livros|         2017|
|Eletrônicos|         2079|
|  Alimentos|         2014|
|   Esportes|         2086|
|     Roupas|         1975|
+-----------+-------------+

</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>dfqry02 = spark.sql("""
SELECT
    ID_CLIENTE,
    ROUND(SUM(VALOR),2) AS VL_TOT_CONSUMO,
    ROUND(AVG(VALOR),2) AS VL_MED_CONSUMO,
    ROUND(MAX(VALOR),2) AS VL_MAX_CONSUMO,
    ROUND(MIN(VALOR),2) AS VL_MIN_CONSUMO,
    
    ROUND(SUM(CASE WHEN CATEGORIA = 'Esportes' THEN VALOR ELSE 0 END),2) AS VL_TOT_CONS_ESPORTES,
    ROUND(AVG(CASE WHEN CATEGORIA = 'Esportes' THEN VALOR ELSE NULL END),2) AS VL_MED_CONS_ESPORTES,
    ROUND(MIN(CASE WHEN CATEGORIA = 'Esportes' THEN VALOR ELSE NULL END),2) AS VL_MIN_CONS_ESPORTES,    
    ROUND(MAX(CASE WHEN CATEGORIA = 'Esportes' THEN VALOR ELSE NULL END),2) AS VL_MAX_CONS_ESPORTES,
    
    ROUND(AVG(CASE WHEN CATEGORIA = 'Esportes' and FLG_U03M = 1 THEN VALOR ELSE NULL END),2) AS VL_MED_U3M_CONS_ESPORTES,
    ROUND(AVG(CASE WHEN CATEGORIA = 'Esportes' and FLG_U06M = 1 THEN VALOR ELSE NULL END),2) AS VL_MED_U6M_CONS_ESPORTES,
    ROUND(AVG(CASE WHEN CATEGORIA = 'Esportes' and FLG_U12M = 1 THEN VALOR ELSE NULL END),2) AS VL_MED_U12M_CONS_ESPORTES,
    
    ROUND(MIN(CASE WHEN CATEGORIA = 'Esportes' and FLG_U03M = 1 THEN VALOR ELSE NULL END),2) AS VL_MIN_U3M_CONS_ESPORTES,
    ROUND(MIN(CASE WHEN CATEGORIA = 'Esportes' and FLG_U06M = 1 THEN VALOR ELSE NULL END),2) AS VL_MIN_U6M_CONS_ESPORTES,
    ROUND(MIN(CASE WHEN CATEGORIA = 'Esportes' and FLG_U12M = 1 THEN VALOR ELSE NULL END),2) AS VL_MIN_U12M_CONS_ESPORTES,
    
    ROUND(MAX(CASE WHEN CATEGORIA = 'Esportes' and FLG_U03M = 1 THEN VALOR ELSE NULL END),2) AS VL_MAX_U3M_CONS_ESPORTES,
    ROUND(MAX(CASE WHEN CATEGORIA = 'Esportes' and FLG_U06M = 1 THEN VALOR ELSE NULL END),2) AS VL_MAX_U6M_CONS_ESPORTES,
    ROUND(MAX(CASE WHEN CATEGORIA = 'Esportes' and FLG_U12M = 1 THEN VALOR ELSE NULL END),2) AS VL_MAX_U12M_CONS_ESPORTES,

    ROUND(SUM(CASE WHEN CATEGORIA = 'Alimentos' THEN VALOR ELSE 0 END),2) AS VL_TOT_CONS_ALIMENTOS,
    ROUND(AVG(CASE WHEN CATEGORIA = 'Alimentos' THEN VALOR ELSE NULL END),2) AS VL_MED_CONS_ALIMENTOS,
    ROUND(MIN(CASE WHEN CATEGORIA = 'Alimentos' THEN VALOR ELSE NULL END),2) AS VL_MIN_CONS_ALIMENTOS,
    ROUND(MAX(CASE WHEN CATEGORIA = 'Alimentos' THEN VALOR ELSE NULL END),2) AS VL_MAX_CONS_ALIMENTOS,    
    
    ROUND(AVG(CASE WHEN CATEGORIA = 'Alimentos' and FLG_U03M = 1 THEN VALOR ELSE NULL END),2) AS VL_MED_U3M_CONS_ALIMENTOS,
    ROUND(AVG(CASE WHEN CATEGORIA = 'Alimentos' and FLG_U06M = 1 THEN VALOR ELSE NULL END),2) AS VL_MED_U6M_CONS_ALIMENTOS,
    ROUND(AVG(CASE WHEN CATEGORIA = 'Alimentos' and FLG_U12M = 1 THEN VALOR ELSE NULL END),2) AS VL_MED_U12M_CONS_ALIMENTOS,

    ROUND(MIN(CASE WHEN CATEGORIA = 'Alimentos' and FLG_U03M = 1 THEN VALOR ELSE NULL END),2) AS VL_MIN_U3M_CONS_ALIMENTOS,
    ROUND(MIN(CASE WHEN CATEGORIA = 'Alimentos' and FLG_U06M = 1 THEN VALOR ELSE NULL END),2) AS VL_MIN_U6M_CONS_ALIMENTOS,
    ROUND(MIN(CASE WHEN CATEGORIA = 'Alimentos' and FLG_U12M = 1 THEN VALOR ELSE NULL END),2) AS VL_MIN_U12M_CONS_ALIMENTOS,
    
    ROUND(MAX(CASE WHEN CATEGORIA = 'Alimentos' and FLG_U03M = 1 THEN VALOR ELSE NULL END),2) AS VL_MAX_U3M_CONS_ALIMENTOS,
    ROUND(MAX(CASE WHEN CATEGORIA = 'Alimentos' and FLG_U06M = 1 THEN VALOR ELSE NULL END),2) AS VL_MAX_U6M_CONS_ALIMENTOS,
    ROUND(MAX(CASE WHEN CATEGORIA = 'Alimentos' and FLG_U12M = 1 THEN VALOR ELSE NULL END),2) AS VL_MAX_U12M_CONS_ALIMENTOS,

    ROUND(SUM(CASE WHEN CATEGORIA = 'Livros' THEN VALOR ELSE 0 END),2) AS VL_TOT_CONS_LIVROS,    
    ROUND(AVG(CASE WHEN CATEGORIA = 'Livros' THEN VALOR ELSE NULL END),2) AS VL_MED_CONS_LIVROS,
    ROUND(MIN(CASE WHEN CATEGORIA = 'Livros' THEN VALOR ELSE NULL END),2) AS VL_MIN_CONS_LIVROS,
    ROUND(MAX(CASE WHEN CATEGORIA = 'Livros' THEN VALOR ELSE NULL END),2) AS VL_MAX_CONS_LIVROS,   
    
    ROUND(AVG(CASE WHEN CATEGORIA = 'Livros' and FLG_U03M = 1 THEN VALOR ELSE NULL END),2) AS VL_MED_U3M_CONS_LIVROS,
    ROUND(AVG(CASE WHEN CATEGORIA = 'Livros' and FLG_U06M = 1 THEN VALOR ELSE NULL END),2) AS VL_MED_U6M_CONS_LIVROS,
    ROUND(AVG(CASE WHEN CATEGORIA = 'Livros' and FLG_U12M = 1 THEN VALOR ELSE NULL END),2) AS VL_MED_U12M_CONS_LIVROS,

    ROUND(MIN(CASE WHEN CATEGORIA = 'Livros' and FLG_U03M = 1 THEN VALOR ELSE NULL END),2) AS VL_MIN_U3M_CONS_LIVROS,
    ROUND(MIN(CASE WHEN CATEGORIA = 'Livros' and FLG_U06M = 1 THEN VALOR ELSE NULL END),2) AS VL_MIN_U6M_CONS_LIVROS,
    ROUND(MIN(CASE WHEN CATEGORIA = 'Livros' and FLG_U12M = 1 THEN VALOR ELSE NULL END),2) AS VL_MIN_U12M_CONS_LIVROS,
    
    ROUND(MAX(CASE WHEN CATEGORIA = 'Livros' and FLG_U03M = 1 THEN VALOR ELSE NULL END),2) AS VL_MAX_U3M_CONS_LIVROS,
    ROUND(MAX(CASE WHEN CATEGORIA = 'Livros' and FLG_U06M = 1 THEN VALOR ELSE NULL END),2) AS VL_MAX_U6M_CONS_LIVROS,
    ROUND(MAX(CASE WHEN CATEGORIA = 'Livros' and FLG_U12M = 1 THEN VALOR ELSE NULL END),2) AS VL_MAX_U12M_CONS_LIVROS,

    ROUND(SUM(CASE WHEN CATEGORIA = 'Eletrônicos' THEN VALOR ELSE 0 END),2) AS VL_TOT_CONS_ELETRONICOS,    
    ROUND(AVG(CASE WHEN CATEGORIA = 'Eletrônicos' THEN VALOR ELSE NULL END),2) AS VL_MED_CONS_ELETRONICOS,
    ROUND(MIN(CASE WHEN CATEGORIA = 'Eletrônicos' THEN VALOR ELSE NULL END),2) AS VL_MIN_CONS_ELETRONICOS,
    ROUND(MAX(CASE WHEN CATEGORIA = 'Eletrônicos' THEN VALOR ELSE NULL END),2) AS VL_MAX_CONS_ELETRONICOS,   
    
    ROUND(AVG(CASE WHEN CATEGORIA = 'Eletrônicos' and FLG_U03M = 1 THEN VALOR ELSE NULL END),2) AS VL_MED_U3M_CONS_ELETRONICOS,
    ROUND(AVG(CASE WHEN CATEGORIA = 'Eletrônicos' and FLG_U06M = 1 THEN VALOR ELSE NULL END),2) AS VL_MED_U6M_CONS_ELETRONICOS,
    ROUND(AVG(CASE WHEN CATEGORIA = 'Eletrônicos' and FLG_U12M = 1 THEN VALOR ELSE NULL END),2) AS VL_MED_U12M_CONS_ELETRONICOS,

    ROUND(MIN(CASE WHEN CATEGORIA = 'Eletrônicos' and FLG_U03M = 1 THEN VALOR ELSE NULL END),2) AS VL_MIN_U3M_CONS_ELETRONICOS,
    ROUND(MIN(CASE WHEN CATEGORIA = 'Eletrônicos' and FLG_U06M = 1 THEN VALOR ELSE NULL END),2) AS VL_MIN_U6M_CONS_ELETRONICOS,
    ROUND(MIN(CASE WHEN CATEGORIA = 'Eletrônicos' and FLG_U12M = 1 THEN VALOR ELSE NULL END),2) AS VL_MIN_U12M_CONS_ELETRONICOS,
    
    ROUND(MAX(CASE WHEN CATEGORIA = 'Eletrônicos' and FLG_U03M = 1 THEN VALOR ELSE NULL END),2) AS VL_MAX_U3M_CONS_ELETRONICOS,
    ROUND(MAX(CASE WHEN CATEGORIA = 'Eletrônicos' and FLG_U06M = 1 THEN VALOR ELSE NULL END),2) AS VL_MAX_U6M_CONS_ELETRONICOS,
    ROUND(MAX(CASE WHEN CATEGORIA = 'Eletrônicos' and FLG_U12M = 1 THEN VALOR ELSE NULL END),2) AS VL_MAX_U12M_CONS_ELETRONICOS,

    ROUND(SUM(CASE WHEN CATEGORIA = 'Roupas' THEN VALOR ELSE 0 END),2) AS VL_TOT_CONS_ROUPAS,    
    ROUND(AVG(CASE WHEN CATEGORIA = 'Roupas' THEN VALOR ELSE NULL END),2) AS VL_MED_CONS_ROUPAS,
    ROUND(MIN(CASE WHEN CATEGORIA = 'Roupas' THEN VALOR ELSE NULL END),2) AS VL_MIN_CONS_ROUPAS,
    ROUND(MAX(CASE WHEN CATEGORIA = 'Roupas' THEN VALOR ELSE NULL END),2) AS VL_MAX_CONS_ROUPAS,   
    
    ROUND(AVG(CASE WHEN CATEGORIA = 'Roupas' and FLG_U03M = 1 THEN VALOR ELSE NULL END),2) AS VL_MED_U3M_CONS_ROUPAS,
    ROUND(AVG(CASE WHEN CATEGORIA = 'Roupas' and FLG_U06M = 1 THEN VALOR ELSE NULL END),2) AS VL_MED_U6M_CONS_ROUPAS,
    ROUND(AVG(CASE WHEN CATEGORIA = 'Roupas' and FLG_U12M = 1 THEN VALOR ELSE NULL END),2) AS VL_MED_U12M_CONS_ROUPAS,

    ROUND(MIN(CASE WHEN CATEGORIA = 'Roupas' and FLG_U03M = 1 THEN VALOR ELSE NULL END),2) AS VL_MIN_U3M_CONS_ROUPAS,
    ROUND(MIN(CASE WHEN CATEGORIA = 'Roupas' and FLG_U06M = 1 THEN VALOR ELSE NULL END),2) AS VL_MIN_U6M_CONS_ROUPAS,
    ROUND(MIN(CASE WHEN CATEGORIA = 'Roupas' and FLG_U12M = 1 THEN VALOR ELSE NULL END),2) AS VL_MIN_U12M_CONS_ROUPAS,
    
    ROUND(MAX(CASE WHEN CATEGORIA = 'Roupas' and FLG_U03M = 1 THEN VALOR ELSE NULL END),2) AS VL_MAX_U3M_CONS_ROUPAS,
    ROUND(MAX(CASE WHEN CATEGORIA = 'Roupas' and FLG_U06M = 1 THEN VALOR ELSE NULL END),2) AS VL_MAX_U6M_CONS_ROUPAS,
    ROUND(MAX(CASE WHEN CATEGORIA = 'Roupas' and FLG_U12M = 1 THEN VALOR ELSE NULL END),2) AS VL_MAX_U12M_CONS_ROUPAS
    
FROM tmpview01
GROUP BY ID_CLIENTE
ORDER BY ID_CLIENTE
""")

dfqry02.createOrReplaceTempView("tmpview02")</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>print("Teste de sanidade - total de registros na base variaveis explicativas de Primeira Camada")
print(dfqry02.count())
print()
print("Variáveis explicativas de Primeira Camada")
print(dfqry02.where(dfqry02['ID_CLIENTE']==1).show(5,False))
print()
print(dfqry01.where((dfqry01['ID_CLIENTE'] == 1) &amp; (dfqry01['CATEGORIA'] == 'Livros')).show(3))
</pre>
</div>
<div class="output">
<pre>Teste de sanidade - total de registros na base variaveis explicativas de Primeira Camada
1000

Variáveis explicativas de Primeira Camada
+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+
|ID_CLIENTE|VL_TOT_CONSUMO|VL_MED_CONSUMO|VL_MAX_CONSUMO|VL_MIN_CONSUMO|VL_TOT_CONS_ESPORTES|VL_MED_CONS_ESPORTES|VL_MIN_CONS_ESPORTES|VL_MAX_CONS_ESPORTES|VL_MED_U3M_CONS_ESPORTES|VL_MED_U6M_CONS_ESPORTES|VL_MED_U12M_CONS_ESPORTES|VL_MIN_U3M_CONS_ESPORTES|VL_MIN_U6M_CONS_ESPORTES|VL_MIN_U12M_CONS_ESPORTES|VL_MAX_U3M_CONS_ESPORTES|VL_MAX_U6M_CONS_ESPORTES|VL_MAX_U12M_CONS_ESPORTES|VL_TOT_CONS_ALIMENTOS|VL_MED_CONS_ALIMENTOS|VL_MIN_CONS_ALIMENTOS|VL_MAX_CONS_ALIMENTOS|VL_MED_U3M_CONS_ALIMENTOS|VL_MED_U6M_CONS_ALIMENTOS|VL_MED_U12M_CONS_ALIMENTOS|VL_MIN_U3M_CONS_ALIMENTOS|VL_MIN_U6M_CONS_ALIMENTOS|VL_MIN_U12M_CONS_ALIMENTOS|VL_MAX_U3M_CONS_ALIMENTOS|VL_MAX_U6M_CONS_ALIMENTOS|VL_MAX_U12M_CONS_ALIMENTOS|VL_TOT_CONS_LIVROS|VL_MED_CONS_LIVROS|VL_MIN_CONS_LIVROS|VL_MAX_CONS_LIVROS|VL_MED_U3M_CONS_LIVROS|VL_MED_U6M_CONS_LIVROS|VL_MED_U12M_CONS_LIVROS|VL_MIN_U3M_CONS_LIVROS|VL_MIN_U6M_CONS_LIVROS|VL_MIN_U12M_CONS_LIVROS|VL_MAX_U3M_CONS_LIVROS|VL_MAX_U6M_CONS_LIVROS|VL_MAX_U12M_CONS_LIVROS|VL_TOT_CONS_ELETRONICOS|VL_MED_CONS_ELETRONICOS|VL_MIN_CONS_ELETRONICOS|VL_MAX_CONS_ELETRONICOS|VL_MED_U3M_CONS_ELETRONICOS|VL_MED_U6M_CONS_ELETRONICOS|VL_MED_U12M_CONS_ELETRONICOS|VL_MIN_U3M_CONS_ELETRONICOS|VL_MIN_U6M_CONS_ELETRONICOS|VL_MIN_U12M_CONS_ELETRONICOS|VL_MAX_U3M_CONS_ELETRONICOS|VL_MAX_U6M_CONS_ELETRONICOS|VL_MAX_U12M_CONS_ELETRONICOS|VL_TOT_CONS_ROUPAS|VL_MED_CONS_ROUPAS|VL_MIN_CONS_ROUPAS|VL_MAX_CONS_ROUPAS|VL_MED_U3M_CONS_ROUPAS|VL_MED_U6M_CONS_ROUPAS|VL_MED_U12M_CONS_ROUPAS|VL_MIN_U3M_CONS_ROUPAS|VL_MIN_U6M_CONS_ROUPAS|VL_MIN_U12M_CONS_ROUPAS|VL_MAX_U3M_CONS_ROUPAS|VL_MAX_U6M_CONS_ROUPAS|VL_MAX_U12M_CONS_ROUPAS|
+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+
|1         |1976.56       |116.27        |199.39        |5.39          |226.73              |113.37              |57.29               |169.44              |57.29                   |57.29                   |57.29                    |57.29                   |57.29                   |57.29                    |57.29                   |57.29                   |57.29                    |351.26               |87.81                |9.84                 |187.82               |NULL                     |187.82                   |187.82                    |NULL                     |187.82                   |187.82                    |NULL                     |187.82                   |187.82                    |551.06            |183.69            |169.11            |193.01            |193.01                |193.01                |183.69                 |193.01                |193.01                |169.11                 |193.01                |193.01                |193.01                 |396.72                 |132.24                 |76.91                  |160.0                  |118.45                     |118.45                     |132.24                      |76.91                      |76.91                      |76.91                       |160.0                      |160.0                      |160.0                       |450.79            |90.16             |5.39              |199.39            |96.4                  |66.07                 |99.4                   |24.12                 |5.39                  |5.39                   |168.69                |168.69                |199.39                 |
+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+

None

+------------+----------+--------------------+------------------+---------+--------------------+--------+--------+--------+
|ID_TRANSACAO|ID_CLIENTE|                DATA|             VALOR|CATEGORIA|                DATA|FLG_U03M|FLG_U06M|FLG_U12M|
+------------+----------+--------------------+------------------+---------+--------------------+--------+--------+--------+
|           3|         1|2021-12-28 12:33:...|169.10581012381087|   Livros|2021-12-28 12:33:...|       0|       0|       1|
|          11|         1|2022-01-01 22:30:...| 188.9532871161914|   Livros|2022-01-01 22:30:...|       0|       0|       1|
|           9|         1|2022-11-02 12:50:...|193.00568791656067|   Livros|2022-11-02 12:50:...|       1|       1|       1|
+------------+----------+--------------------+------------------+---------+--------------------+--------+--------+--------+

None
</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>Variáveis explicativas de Primeira Camada
+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+
|ID_CLIENTE|VL_TOT_CONSUMO|VL_MED_CONSUMO|VL_MAX_CONSUMO|VL_MIN_CONSUMO|VL_TOT_CONS_ESPORTES|VL_MED_CONS_ESPORTES|VL_MIN_CONS_ESPORTES|VL_MAX_CONS_ESPORTES|VL_MED_U3M_CONS_ESPORTES|VL_MED_U6M_CONS_ESPORTES|VL_MED_U12M_CONS_ESPORTES|VL_MIN_U3M_CONS_ESPORTES|VL_MIN_U6M_CONS_ESPORTES|VL_MIN_U12M_CONS_ESPORTES|VL_MAX_U3M_CONS_ESPORTES|VL_MAX_U6M_CONS_ESPORTES|VL_MAX_U12M_CONS_ESPORTES|VL_TOT_CONS_ALIMENTOS|VL_MED_CONS_ALIMENTOS|VL_MIN_CONS_ALIMENTOS|VL_MAX_CONS_ALIMENTOS|VL_MED_U3M_CONS_ALIMENTOS|VL_MED_U6M_CONS_ALIMENTOS|VL_MED_U12M_CONS_ALIMENTOS|VL_MIN_U3M_CONS_ALIMENTOS|VL_MIN_U6M_CONS_ALIMENTOS|VL_MIN_U12M_CONS_ALIMENTOS|VL_MAX_U3M_CONS_ALIMENTOS|VL_MAX_U6M_CONS_ALIMENTOS|VL_MAX_U12M_CONS_ALIMENTOS|VL_TOT_CONS_LIVROS|VL_MED_CONS_LIVROS|VL_MIN_CONS_LIVROS|VL_MAX_CONS_LIVROS|VL_MED_U3M_CONS_LIVROS|VL_MED_U6M_CONS_LIVROS|VL_MED_U12M_CONS_LIVROS|VL_MIN_U3M_CONS_LIVROS|VL_MIN_U6M_CONS_LIVROS|VL_MIN_U12M_CONS_LIVROS|VL_MAX_U3M_CONS_LIVROS|VL_MAX_U6M_CONS_LIVROS|VL_MAX_U12M_CONS_LIVROS|VL_TOT_CONS_ELETRONICOS|VL_MED_CONS_ELETRONICOS|VL_MIN_CONS_ELETRONICOS|VL_MAX_CONS_ELETRONICOS|VL_MED_U3M_CONS_ELETRONICOS|VL_MED_U6M_CONS_ELETRONICOS|VL_MED_U12M_CONS_ELETRONICOS|VL_MIN_U3M_CONS_ELETRONICOS|VL_MIN_U6M_CONS_ELETRONICOS|VL_MIN_U12M_CONS_ELETRONICOS|VL_MAX_U3M_CONS_ELETRONICOS|VL_MAX_U6M_CONS_ELETRONICOS|VL_MAX_U12M_CONS_ELETRONICOS|VL_TOT_CONS_ROUPAS|VL_MED_CONS_ROUPAS|VL_MIN_CONS_ROUPAS|VL_MAX_CONS_ROUPAS|VL_MED_U3M_CONS_ROUPAS|VL_MED_U6M_CONS_ROUPAS|VL_MED_U12M_CONS_ROUPAS|VL_MIN_U3M_CONS_ROUPAS|VL_MIN_U6M_CONS_ROUPAS|VL_MIN_U12M_CONS_ROUPAS|VL_MAX_U3M_CONS_ROUPAS|VL_MAX_U6M_CONS_ROUPAS|VL_MAX_U12M_CONS_ROUPAS|
+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+
|1         |1976.56       |116.27        |199.39        |5.39          |226.73              |113.37              |57.29               |169.44              |57.29                   |57.29                   |57.29                    |57.29                   |57.29                   |57.29                    |57.29                   |57.29                   |57.29                    |351.26               |87.81                |9.84                 |187.82               |NULL                     |187.82                   |187.82                    |NULL                     |187.82                   |187.82                    |NULL                     |187.82                   |187.82                    |551.06            |183.69            |169.11            |193.01            |193.01                |193.01                |183.69                 |193.01                |193.01                |169.11                 |193.01                |193.01                |193.01                 |396.72                 |132.24                 |76.91                  |160.0                  |118.45                     |118.45                     |132.24                      |76.91                      |76.91                      |76.91                       |160.0                      |160.0                      |160.0                       |450.79            |90.16             |5.39              |199.39            |96.4                  |66.07                 |99.4                   |24.12                 |5.39                  |5.39                   |168.69                |168.69                |199.39                 |
+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>from pyspark.sql import functions as F

def generate_category_features(df, categorias, valor_col, categoria_col, id_col):
    # Lista para armazenar as expressões SQL
    expressions = []
    
    # Loop para cada categoria
    for categoria in categorias:
        prefix = f"VL_{categoria.upper().replace(' ', '_')}"
        
        expressions.append(F.round(F.sum(F.when(F.col(categoria_col) == categoria, F.col(valor_col)).otherwise(0)), 2).alias(f"{prefix}_TOT_CONSUMO"))
        expressions.append(F.round(F.avg(F.when(F.col(categoria_col) == categoria, F.col(valor_col)).otherwise(None)), 2).alias(f"{prefix}_MED_CONSUMO"))
        expressions.append(F.round(F.min(F.when(F.col(categoria_col) == categoria, F.col(valor_col)).otherwise(None)), 2).alias(f"{prefix}_MIN_CONSUMO"))
        expressions.append(F.round(F.max(F.when(F.col(categoria_col) == categoria, F.col(valor_col)).otherwise(None)), 2).alias(f"{prefix}_MAX_CONSUMO"))
        
        for period, flag_col in zip(['U3M', 'U6M', 'U12M'], ['FLG_U03M', 'FLG_U06M', 'FLG_U12M']):
            expressions.append(F.round(F.avg(F.when((F.col(categoria_col) == categoria) &amp; (F.col(flag_col) == 1), F.col(valor_col)).otherwise(None)), 2).alias(f"{prefix}_MED_{period}_CONSUMO"))
            expressions.append(F.round(F.min(F.when((F.col(categoria_col) == categoria) &amp; (F.col(flag_col) == 1), F.col(valor_col)).otherwise(None)), 2).alias(f"{prefix}_MIN_{period}_CONSUMO"))
            expressions.append(F.round(F.max(F.when((F.col(categoria_col) == categoria) &amp; (F.col(flag_col) == 1), F.col(valor_col)).otherwise(None)), 2).alias(f"{prefix}_MAX_{period}_CONSUMO"))

    # Agrupa pelos IDs e aplica as expressões
    df_aggregated = df.groupBy(id_col).agg(*expressions)
    
    return df_aggregated</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre># Exemplo de uso
categorias = ["Esportes", "Alimentos", "Livros", "Eletrônicos", "Roupas"]
dfqry02x = generate_category_features(df=spark.table("tmpview01"), categorias=categorias, valor_col="VALOR", categoria_col="CATEGORIA", id_col="ID_CLIENTE")

dfqry02x.show(5)
#dfqry02.createOrReplaceTempView("tmpview02")</pre>
</div>
<div class="output">
<pre>+----------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+---------------------------+---------------------------+---------------------------+---------------------------+----------------------------+----------------------------+----------------------------+------------------------+------------------------+------------------------+------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+-----------------------------+-----------------------------+-----------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+--------------------------+--------------------------+--------------------------+--------------------------+--------------------------+--------------------------+--------------------------+------------------------------+------------------------------+------------------------------+------------------------------+------------------------------+------------------------------+-------------------------------+-------------------------------+-------------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+--------------------------+--------------------------+--------------------------+
|ID_CLIENTE|VL_ESPORTES_TOT_CONSUMO|VL_ESPORTES_MED_CONSUMO|VL_ESPORTES_MIN_CONSUMO|VL_ESPORTES_MAX_CONSUMO|VL_ESPORTES_MED_U3M_CONSUMO|VL_ESPORTES_MIN_U3M_CONSUMO|VL_ESPORTES_MAX_U3M_CONSUMO|VL_ESPORTES_MED_U6M_CONSUMO|VL_ESPORTES_MIN_U6M_CONSUMO|VL_ESPORTES_MAX_U6M_CONSUMO|VL_ESPORTES_MED_U12M_CONSUMO|VL_ESPORTES_MIN_U12M_CONSUMO|VL_ESPORTES_MAX_U12M_CONSUMO|VL_ALIMENTOS_TOT_CONSUMO|VL_ALIMENTOS_MED_CONSUMO|VL_ALIMENTOS_MIN_CONSUMO|VL_ALIMENTOS_MAX_CONSUMO|VL_ALIMENTOS_MED_U3M_CONSUMO|VL_ALIMENTOS_MIN_U3M_CONSUMO|VL_ALIMENTOS_MAX_U3M_CONSUMO|VL_ALIMENTOS_MED_U6M_CONSUMO|VL_ALIMENTOS_MIN_U6M_CONSUMO|VL_ALIMENTOS_MAX_U6M_CONSUMO|VL_ALIMENTOS_MED_U12M_CONSUMO|VL_ALIMENTOS_MIN_U12M_CONSUMO|VL_ALIMENTOS_MAX_U12M_CONSUMO|VL_LIVROS_TOT_CONSUMO|VL_LIVROS_MED_CONSUMO|VL_LIVROS_MIN_CONSUMO|VL_LIVROS_MAX_CONSUMO|VL_LIVROS_MED_U3M_CONSUMO|VL_LIVROS_MIN_U3M_CONSUMO|VL_LIVROS_MAX_U3M_CONSUMO|VL_LIVROS_MED_U6M_CONSUMO|VL_LIVROS_MIN_U6M_CONSUMO|VL_LIVROS_MAX_U6M_CONSUMO|VL_LIVROS_MED_U12M_CONSUMO|VL_LIVROS_MIN_U12M_CONSUMO|VL_LIVROS_MAX_U12M_CONSUMO|VL_ELETRÔNICOS_TOT_CONSUMO|VL_ELETRÔNICOS_MED_CONSUMO|VL_ELETRÔNICOS_MIN_CONSUMO|VL_ELETRÔNICOS_MAX_CONSUMO|VL_ELETRÔNICOS_MED_U3M_CONSUMO|VL_ELETRÔNICOS_MIN_U3M_CONSUMO|VL_ELETRÔNICOS_MAX_U3M_CONSUMO|VL_ELETRÔNICOS_MED_U6M_CONSUMO|VL_ELETRÔNICOS_MIN_U6M_CONSUMO|VL_ELETRÔNICOS_MAX_U6M_CONSUMO|VL_ELETRÔNICOS_MED_U12M_CONSUMO|VL_ELETRÔNICOS_MIN_U12M_CONSUMO|VL_ELETRÔNICOS_MAX_U12M_CONSUMO|VL_ROUPAS_TOT_CONSUMO|VL_ROUPAS_MED_CONSUMO|VL_ROUPAS_MIN_CONSUMO|VL_ROUPAS_MAX_CONSUMO|VL_ROUPAS_MED_U3M_CONSUMO|VL_ROUPAS_MIN_U3M_CONSUMO|VL_ROUPAS_MAX_U3M_CONSUMO|VL_ROUPAS_MED_U6M_CONSUMO|VL_ROUPAS_MIN_U6M_CONSUMO|VL_ROUPAS_MAX_U6M_CONSUMO|VL_ROUPAS_MED_U12M_CONSUMO|VL_ROUPAS_MIN_U12M_CONSUMO|VL_ROUPAS_MAX_U12M_CONSUMO|
+----------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+---------------------------+---------------------------+---------------------------+---------------------------+----------------------------+----------------------------+----------------------------+------------------------+------------------------+------------------------+------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+-----------------------------+-----------------------------+-----------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+--------------------------+--------------------------+--------------------------+--------------------------+--------------------------+--------------------------+--------------------------+------------------------------+------------------------------+------------------------------+------------------------------+------------------------------+------------------------------+-------------------------------+-------------------------------+-------------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+--------------------------+--------------------------+--------------------------+
|       148|                  463.3|                  77.22|                  20.32|                 190.06|                     190.06|                     190.06|                     190.06|                     105.19|                      20.32|                     190.06|                       91.69|                       20.32|                      190.06|                  665.83|                  110.97|                   25.42|                  188.17|                       83.42|                       83.42|                       83.42|                       83.42|                       83.42|                       83.42|                       106.55|                        83.42|                       129.69|               218.87|               109.43|                61.85|               157.02|                     NULL|                     NULL|                     NULL|                     NULL|                     NULL|                     NULL|                      NULL|                      NULL|                      NULL|                    280.39|                     93.46|                     63.83|                    142.24|                         63.83|                         63.83|                         63.83|                         63.83|                         63.83|                         63.83|                          63.83|                          63.83|                          63.83|               139.53|               139.53|               139.53|               139.53|                     NULL|                     NULL|                     NULL|                   139.53|                   139.53|                   139.53|                    139.53|                    139.53|                    139.53|
|       463|                  63.06|                  63.06|                  63.06|                  63.06|                      63.06|                      63.06|                      63.06|                      63.06|                      63.06|                      63.06|                       63.06|                       63.06|                       63.06|                     0.0|                    NULL|                    NULL|                    NULL|                        NULL|                        NULL|                        NULL|                        NULL|                        NULL|                        NULL|                         NULL|                         NULL|                         NULL|               156.69|               156.69|               156.69|               156.69|                   156.69|                   156.69|                   156.69|                   156.69|                   156.69|                   156.69|                    156.69|                    156.69|                    156.69|                    150.78|                     75.39|                      8.16|                    142.62|                          NULL|                          NULL|                          NULL|                          NULL|                          NULL|                          NULL|                         142.62|                         142.62|                         142.62|               189.23|                94.61|                80.97|               108.26|                    80.97|                    80.97|                    80.97|                    80.97|                    80.97|                    80.97|                     80.97|                     80.97|                     80.97|
|       471|                 170.39|                 170.39|                 170.39|                 170.39|                       NULL|                       NULL|                       NULL|                       NULL|                       NULL|                       NULL|                        NULL|                        NULL|                        NULL|                   482.8|                   120.7|                   84.58|                   193.7|                       88.59|                       88.59|                       88.59|                       86.58|                       84.58|                       88.59|                        86.58|                        84.58|                        88.59|               359.37|               119.79|                 64.6|               181.99|                     NULL|                     NULL|                     NULL|                     NULL|                     NULL|                     NULL|                      NULL|                      NULL|                      NULL|                    549.61|                     137.4|                      97.8|                    180.19|                          NULL|                          NULL|                          NULL|                          NULL|                          NULL|                          NULL|                         154.98|                         154.98|                         154.98|               745.22|               149.04|               105.66|               189.48|                   141.63|                   141.63|                   141.63|                   141.96|                   141.63|                   142.29|                    150.03|                    141.63|                    166.16|
|       496|                    0.0|                   NULL|                   NULL|                   NULL|                       NULL|                       NULL|                       NULL|                       NULL|                       NULL|                       NULL|                        NULL|                        NULL|                        NULL|                     0.0|                    NULL|                    NULL|                    NULL|                        NULL|                        NULL|                        NULL|                        NULL|                        NULL|                        NULL|                         NULL|                         NULL|                         NULL|                64.87|                64.87|                64.87|                64.87|                     NULL|                     NULL|                     NULL|                     NULL|                     NULL|                     NULL|                     64.87|                     64.87|                     64.87|                       0.0|                      NULL|                      NULL|                      NULL|                          NULL|                          NULL|                          NULL|                          NULL|                          NULL|                          NULL|                           NULL|                           NULL|                           NULL|               105.74|               105.74|               105.74|               105.74|                   105.74|                   105.74|                   105.74|                   105.74|                   105.74|                   105.74|                    105.74|                    105.74|                    105.74|
|       833|                  85.88|                  85.88|                  85.88|                  85.88|                       NULL|                       NULL|                       NULL|                       NULL|                       NULL|                       NULL|                        NULL|                        NULL|                        NULL|                  153.81|                  153.81|                  153.81|                  153.81|                        NULL|                        NULL|                        NULL|                        NULL|                        NULL|                        NULL|                       153.81|                       153.81|                       153.81|               353.84|               117.95|                53.14|               184.31|                   116.39|                   116.39|                   116.39|                   116.39|                   116.39|                   116.39|                    116.39|                    116.39|                    116.39|                    224.88|                    112.44|                     49.74|                    175.14|                        175.14|                        175.14|                        175.14|                        175.14|                        175.14|                        175.14|                         175.14|                         175.14|                         175.14|                99.12|                49.56|                 9.73|                89.39|                     NULL|                     NULL|                     NULL|                     NULL|                     NULL|                     NULL|                      NULL|                      NULL|                      NULL|
+----------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+---------------------------+---------------------------+---------------------------+---------------------------+----------------------------+----------------------------+----------------------------+------------------------+------------------------+------------------------+------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+-----------------------------+-----------------------------+-----------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+--------------------------+--------------------------+--------------------------+--------------------------+--------------------------+--------------------------+--------------------------+------------------------------+------------------------------+------------------------------+------------------------------+------------------------------+------------------------------+-------------------------------+-------------------------------+-------------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+--------------------------+--------------------------+--------------------------+
only showing top 5 rows

</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>+----------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+---------------------------+---------------------------+---------------------------+---------------------------+----------------------------+----------------------------+----------------------------+------------------------+------------------------+------------------------+------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+-----------------------------+-----------------------------+-----------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+--------------------------+--------------------------+--------------------------+--------------------------+--------------------------+--------------------------+--------------------------+------------------------------+------------------------------+------------------------------+------------------------------+------------------------------+------------------------------+-------------------------------+-------------------------------+-------------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+--------------------------+--------------------------+--------------------------+
|ID_CLIENTE|VL_ESPORTES_TOT_CONSUMO|VL_ESPORTES_MED_CONSUMO|VL_ESPORTES_MIN_CONSUMO|VL_ESPORTES_MAX_CONSUMO|VL_ESPORTES_MED_U3M_CONSUMO|VL_ESPORTES_MIN_U3M_CONSUMO|VL_ESPORTES_MAX_U3M_CONSUMO|VL_ESPORTES_MED_U6M_CONSUMO|VL_ESPORTES_MIN_U6M_CONSUMO|VL_ESPORTES_MAX_U6M_CONSUMO|VL_ESPORTES_MED_U12M_CONSUMO|VL_ESPORTES_MIN_U12M_CONSUMO|VL_ESPORTES_MAX_U12M_CONSUMO|VL_ALIMENTOS_TOT_CONSUMO|VL_ALIMENTOS_MED_CONSUMO|VL_ALIMENTOS_MIN_CONSUMO|VL_ALIMENTOS_MAX_CONSUMO|VL_ALIMENTOS_MED_U3M_CONSUMO|VL_ALIMENTOS_MIN_U3M_CONSUMO|VL_ALIMENTOS_MAX_U3M_CONSUMO|VL_ALIMENTOS_MED_U6M_CONSUMO|VL_ALIMENTOS_MIN_U6M_CONSUMO|VL_ALIMENTOS_MAX_U6M_CONSUMO|VL_ALIMENTOS_MED_U12M_CONSUMO|VL_ALIMENTOS_MIN_U12M_CONSUMO|VL_ALIMENTOS_MAX_U12M_CONSUMO|VL_LIVROS_TOT_CONSUMO|VL_LIVROS_MED_CONSUMO|VL_LIVROS_MIN_CONSUMO|VL_LIVROS_MAX_CONSUMO|VL_LIVROS_MED_U3M_CONSUMO|VL_LIVROS_MIN_U3M_CONSUMO|VL_LIVROS_MAX_U3M_CONSUMO|VL_LIVROS_MED_U6M_CONSUMO|VL_LIVROS_MIN_U6M_CONSUMO|VL_LIVROS_MAX_U6M_CONSUMO|VL_LIVROS_MED_U12M_CONSUMO|VL_LIVROS_MIN_U12M_CONSUMO|VL_LIVROS_MAX_U12M_CONSUMO|VL_ELETRÔNICOS_TOT_CONSUMO|VL_ELETRÔNICOS_MED_CONSUMO|VL_ELETRÔNICOS_MIN_CONSUMO|VL_ELETRÔNICOS_MAX_CONSUMO|VL_ELETRÔNICOS_MED_U3M_CONSUMO|VL_ELETRÔNICOS_MIN_U3M_CONSUMO|VL_ELETRÔNICOS_MAX_U3M_CONSUMO|VL_ELETRÔNICOS_MED_U6M_CONSUMO|VL_ELETRÔNICOS_MIN_U6M_CONSUMO|VL_ELETRÔNICOS_MAX_U6M_CONSUMO|VL_ELETRÔNICOS_MED_U12M_CONSUMO|VL_ELETRÔNICOS_MIN_U12M_CONSUMO|VL_ELETRÔNICOS_MAX_U12M_CONSUMO|VL_ROUPAS_TOT_CONSUMO|VL_ROUPAS_MED_CONSUMO|VL_ROUPAS_MIN_CONSUMO|VL_ROUPAS_MAX_CONSUMO|VL_ROUPAS_MED_U3M_CONSUMO|VL_ROUPAS_MIN_U3M_CONSUMO|VL_ROUPAS_MAX_U3M_CONSUMO|VL_ROUPAS_MED_U6M_CONSUMO|VL_ROUPAS_MIN_U6M_CONSUMO|VL_ROUPAS_MAX_U6M_CONSUMO|VL_ROUPAS_MED_U12M_CONSUMO|VL_ROUPAS_MIN_U12M_CONSUMO|VL_ROUPAS_MAX_U12M_CONSUMO|
+----------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+---------------------------+---------------------------+---------------------------+---------------------------+----------------------------+----------------------------+----------------------------+------------------------+------------------------+------------------------+------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+-----------------------------+-----------------------------+-----------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+--------------------------+--------------------------+--------------------------+--------------------------+--------------------------+--------------------------+--------------------------+------------------------------+------------------------------+------------------------------+------------------------------+------------------------------+------------------------------+-------------------------------+-------------------------------+-------------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+--------------------------+--------------------------+--------------------------+
|       148|                  463.3|                  77.22|                  20.32|                 190.06|                     190.06|                     190.06|                     190.06|                     105.19|                      20.32|                     190.06|                       91.69|                       20.32|                      190.06|                  665.83|                  110.97|                   25.42|                  188.17|                       83.42|                       83.42|                       83.42|                       83.42|                       83.42|                       83.42|                       106.55|                        83.42|                       129.69|               218.87|               109.43|                61.85|               157.02|                     NULL|                     NULL|                     NULL|                     NULL|                     NULL|                     NULL|                      NULL|                      NULL|                      NULL|                    280.39|                     93.46|                     63.83|                    142.24|                         63.83|                         63.83|                         63.83|                         63.83|                         63.83|                         63.83|                          63.83|                          63.83|                          63.83|               139.53|               139.53|               139.53|               139.53|                     NULL|                     NULL|                     NULL|                   139.53|                   139.53|                   139.53|                    139.53|                    139.53|                    139.53|
|       463|                  63.06|                  63.06|                  63.06|                  63.06|                      63.06|                      63.06|                      63.06|                      63.06|                      63.06|                      63.06|                       63.06|                       63.06|                       63.06|                     0.0|                    NULL|                    NULL|                    NULL|                        NULL|                        NULL|                        NULL|                        NULL|                        NULL|                        NULL|                         NULL|                         NULL|                         NULL|               156.69|               156.69|               156.69|               156.69|                   156.69|                   156.69|                   156.69|                   156.69|                   156.69|                   156.69|                    156.69|                    156.69|                    156.69|                    150.78|                     75.39|                      8.16|                    142.62|                          NULL|                          NULL|                          NULL|                          NULL|                          NULL|                          NULL|                         142.62|                         142.62|                         142.62|               189.23|                94.61|                80.97|               108.26|                    80.97|                    80.97|                    80.97|                    80.97|                    80.97|                    80.97|                     80.97|                     80.97|                     80.97|
|       471|                 170.39|                 170.39|                 170.39|                 170.39|                       NULL|                       NULL|                       NULL|                       NULL|                       NULL|                       NULL|                        NULL|                        NULL|                        NULL|                   482.8|                   120.7|                   84.58|                   193.7|                       88.59|                       88.59|                       88.59|                       86.58|                       84.58|                       88.59|                        86.58|                        84.58|                        88.59|               359.37|               119.79|                 64.6|               181.99|                     NULL|                     NULL|                     NULL|                     NULL|                     NULL|                     NULL|                      NULL|                      NULL|                      NULL|                    549.61|                     137.4|                      97.8|                    180.19|                          NULL|                          NULL|                          NULL|                          NULL|                          NULL|                          NULL|                         154.98|                         154.98|                         154.98|               745.22|               149.04|               105.66|               189.48|                   141.63|                   141.63|                   141.63|                   141.96|                   141.63|                   142.29|                    150.03|                    141.63|                    166.16|
|       496|                    0.0|                   NULL|                   NULL|                   NULL|                       NULL|                       NULL|                       NULL|                       NULL|                       NULL|                       NULL|                        NULL|                        NULL|                        NULL|                     0.0|                    NULL|                    NULL|                    NULL|                        NULL|                        NULL|                        NULL|                        NULL|                        NULL|                        NULL|                         NULL|                         NULL|                         NULL|                64.87|                64.87|                64.87|                64.87|                     NULL|                     NULL|                     NULL|                     NULL|                     NULL|                     NULL|                     64.87|                     64.87|                     64.87|                       0.0|                      NULL|                      NULL|                      NULL|                          NULL|                          NULL|                          NULL|                          NULL|                          NULL|                          NULL|                           NULL|                           NULL|                           NULL|               105.74|               105.74|               105.74|               105.74|                   105.74|                   105.74|                   105.74|                   105.74|                   105.74|                   105.74|                    105.74|                    105.74|                    105.74|
|       833|                  85.88|                  85.88|                  85.88|                  85.88|                       NULL|                       NULL|                       NULL|                       NULL|                       NULL|                       NULL|                        NULL|                        NULL|                        NULL|                  153.81|                  153.81|                  153.81|                  153.81|                        NULL|                        NULL|                        NULL|                        NULL|                        NULL|                        NULL|                       153.81|                       153.81|                       153.81|               353.84|               117.95|                53.14|               184.31|                   116.39|                   116.39|                   116.39|                   116.39|                   116.39|                   116.39|                    116.39|                    116.39|                    116.39|                    224.88|                    112.44|                     49.74|                    175.14|                        175.14|                        175.14|                        175.14|                        175.14|                        175.14|                        175.14|                         175.14|                         175.14|                         175.14|                99.12|                49.56|                 9.73|                89.39|                     NULL|                     NULL|                     NULL|                     NULL|                     NULL|                     NULL|                      NULL|                      NULL|                      NULL|
+----------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+---------------------------+---------------------------+---------------------------+---------------------------+----------------------------+----------------------------+----------------------------+------------------------+------------------------+------------------------+------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+-----------------------------+-----------------------------+-----------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+--------------------------+--------------------------+--------------------------+--------------------------+--------------------------+--------------------------+--------------------------+------------------------------+------------------------------+------------------------------+------------------------------+------------------------------+------------------------------+-------------------------------+-------------------------------+-------------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+-------------------------+--------------------------+--------------------------+--------------------------+
only showing top 5 rows
</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#F3F2EE">
<h2 id="Criando-vari%C3%A1veis-explicativas-de-%22Segunda-Camada%22"><font color="#CC403E" face="Segoe Print" size="4"><strong>Criando variáveis explicativas de "Segunda Camada"</strong></font><a class="anchor-link" href="#Criando-vari%C3%A1veis-explicativas-de-%22Segunda-Camada%22">¶</a></h2><font color="#66666" face="Segoe Print" size="3">
<ul>
<li>Razão entre variáveis históricas, são boas para verificar tendências.</li>
</ul>
</font></div>
<div class="cell">
<div class="code_cell">
<pre>dfqry03 = spark.sql("""
SELECT
*,
ROUND(VL_MED_U3M_CONS_ESPORTES/VL_MED_U6M_CONS_ESPORTES,2) AS VL_RAZ_MED_U3M_U6M_CONS_ESP,
ROUND(VL_MED_U6M_CONS_ESPORTES/VL_MED_U12M_CONS_ESPORTES,2) AS VL_RAZ_MED_U6M_U12M_CONS_ESP,
ROUND(VL_MED_U3M_CONS_ALIMENTOS/VL_MED_U6M_CONS_ALIMENTOS,2) AS VL_RAZ_MED_U3M_U6M_CONS_ALI,
ROUND(VL_MED_U6M_CONS_ALIMENTOS/VL_MED_U12M_CONS_ALIMENTOS,2) AS VL_RAZ_MED_U6M_U12M_CONS_ALI,
ROUND(VL_MED_U3M_CONS_LIVROS/VL_MED_U6M_CONS_LIVROS,2) AS VL_RAZ_MED_U3M_U6M_CONS_LIV,
ROUND(VL_MED_U6M_CONS_LIVROS/VL_MED_U12M_CONS_LIVROS,2) AS VL_RAZ_MED_U6M_U12M_CONS_LIV,
ROUND(VL_MED_U3M_CONS_ELETRONICOS/VL_MED_U6M_CONS_ELETRONICOS,2) AS VL_RAZ_MED_U3M_U6M_CONS_ELE,
ROUND(VL_MED_U6M_CONS_ELETRONICOS/VL_MED_U12M_CONS_ELETRONICOS,2) AS VL_RAZ_MED_U6M_U12M_CONS_ELE,
ROUND(VL_MED_U3M_CONS_ROUPAS/VL_MED_U6M_CONS_ROUPAS,2) AS VL_RAZ_MED_U3M_U6M_CONS_ROU,
ROUND(VL_MED_U6M_CONS_ROUPAS/VL_MED_U12M_CONS_ROUPAS,2) AS VL_RAZ_MED_U6M_U12M_CONS_ROU
FROM tmpview02
""")

dfqry03.createOrReplaceTempView("tmpview03")</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>print("Teste de sanidade - total de registros na base variaveis explicativas de Segunda Camada")
print(dfqry03.count())
print()
print(dfqry03.show(3,False))</pre>
</div>
<div class="output">
<pre>Teste de sanidade - total de registros na base variaveis explicativas de Segunda Camada
1000

+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+
|ID_CLIENTE|VL_TOT_CONSUMO|VL_MED_CONSUMO|VL_MAX_CONSUMO|VL_MIN_CONSUMO|VL_TOT_CONS_ESPORTES|VL_MED_CONS_ESPORTES|VL_MIN_CONS_ESPORTES|VL_MAX_CONS_ESPORTES|VL_MED_U3M_CONS_ESPORTES|VL_MED_U6M_CONS_ESPORTES|VL_MED_U12M_CONS_ESPORTES|VL_MIN_U3M_CONS_ESPORTES|VL_MIN_U6M_CONS_ESPORTES|VL_MIN_U12M_CONS_ESPORTES|VL_MAX_U3M_CONS_ESPORTES|VL_MAX_U6M_CONS_ESPORTES|VL_MAX_U12M_CONS_ESPORTES|VL_TOT_CONS_ALIMENTOS|VL_MED_CONS_ALIMENTOS|VL_MIN_CONS_ALIMENTOS|VL_MAX_CONS_ALIMENTOS|VL_MED_U3M_CONS_ALIMENTOS|VL_MED_U6M_CONS_ALIMENTOS|VL_MED_U12M_CONS_ALIMENTOS|VL_MIN_U3M_CONS_ALIMENTOS|VL_MIN_U6M_CONS_ALIMENTOS|VL_MIN_U12M_CONS_ALIMENTOS|VL_MAX_U3M_CONS_ALIMENTOS|VL_MAX_U6M_CONS_ALIMENTOS|VL_MAX_U12M_CONS_ALIMENTOS|VL_TOT_CONS_LIVROS|VL_MED_CONS_LIVROS|VL_MIN_CONS_LIVROS|VL_MAX_CONS_LIVROS|VL_MED_U3M_CONS_LIVROS|VL_MED_U6M_CONS_LIVROS|VL_MED_U12M_CONS_LIVROS|VL_MIN_U3M_CONS_LIVROS|VL_MIN_U6M_CONS_LIVROS|VL_MIN_U12M_CONS_LIVROS|VL_MAX_U3M_CONS_LIVROS|VL_MAX_U6M_CONS_LIVROS|VL_MAX_U12M_CONS_LIVROS|VL_TOT_CONS_ELETRONICOS|VL_MED_CONS_ELETRONICOS|VL_MIN_CONS_ELETRONICOS|VL_MAX_CONS_ELETRONICOS|VL_MED_U3M_CONS_ELETRONICOS|VL_MED_U6M_CONS_ELETRONICOS|VL_MED_U12M_CONS_ELETRONICOS|VL_MIN_U3M_CONS_ELETRONICOS|VL_MIN_U6M_CONS_ELETRONICOS|VL_MIN_U12M_CONS_ELETRONICOS|VL_MAX_U3M_CONS_ELETRONICOS|VL_MAX_U6M_CONS_ELETRONICOS|VL_MAX_U12M_CONS_ELETRONICOS|VL_TOT_CONS_ROUPAS|VL_MED_CONS_ROUPAS|VL_MIN_CONS_ROUPAS|VL_MAX_CONS_ROUPAS|VL_MED_U3M_CONS_ROUPAS|VL_MED_U6M_CONS_ROUPAS|VL_MED_U12M_CONS_ROUPAS|VL_MIN_U3M_CONS_ROUPAS|VL_MIN_U6M_CONS_ROUPAS|VL_MIN_U12M_CONS_ROUPAS|VL_MAX_U3M_CONS_ROUPAS|VL_MAX_U6M_CONS_ROUPAS|VL_MAX_U12M_CONS_ROUPAS|VL_RAZ_MED_U3M_U6M_CONS_ESP|VL_RAZ_MED_U6M_U12M_CONS_ESP|VL_RAZ_MED_U3M_U6M_CONS_ALI|VL_RAZ_MED_U6M_U12M_CONS_ALI|VL_RAZ_MED_U3M_U6M_CONS_LIV|VL_RAZ_MED_U6M_U12M_CONS_LIV|VL_RAZ_MED_U3M_U6M_CONS_ELE|VL_RAZ_MED_U6M_U12M_CONS_ELE|VL_RAZ_MED_U3M_U6M_CONS_ROU|VL_RAZ_MED_U6M_U12M_CONS_ROU|
+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+
|1         |1976.56       |116.27        |199.39        |5.39          |226.73              |113.37              |57.29               |169.44              |57.29                   |57.29                   |57.29                    |57.29                   |57.29                   |57.29                    |57.29                   |57.29                   |57.29                    |351.26               |87.81                |9.84                 |187.82               |NULL                     |187.82                   |187.82                    |NULL                     |187.82                   |187.82                    |NULL                     |187.82                   |187.82                    |551.06            |183.69            |169.11            |193.01            |193.01                |193.01                |183.69                 |193.01                |193.01                |169.11                 |193.01                |193.01                |193.01                 |396.72                 |132.24                 |76.91                  |160.0                  |118.45                     |118.45                     |132.24                      |76.91                      |76.91                      |76.91                       |160.0                      |160.0                      |160.0                       |450.79            |90.16             |5.39              |199.39            |96.4                  |66.07                 |99.4                   |24.12                 |5.39                  |5.39                   |168.69                |168.69                |199.39                 |1.0                        |1.0                         |NULL                       |1.0                         |1.0                        |1.05                        |1.0                        |0.9                         |1.46                       |0.66                        |
|2         |1017.8        |101.78        |192.63        |47.58         |275.47              |91.82               |57.35               |111.9               |57.35                   |57.35                   |84.62                    |57.35                   |57.35                   |57.35                    |57.35                   |57.35                   |111.9                    |109.58               |54.79                |47.58                |62.0                 |47.58                    |54.79                    |54.79                     |47.58                    |47.58                    |47.58                     |47.58                    |62.0                     |62.0                      |340.59            |170.29            |147.96            |192.63            |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |292.16                 |97.39                  |69.05                  |123.23                 |NULL                       |69.05                      |69.05                       |NULL                       |69.05                      |69.05                       |NULL                       |69.05                      |69.05                       |0.0               |NULL              |NULL              |NULL              |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |1.0                        |0.68                        |0.87                       |1.0                         |NULL                       |NULL                        |NULL                       |1.0                         |NULL                       |NULL                        |
|3         |997.81        |110.87        |191.09        |41.91         |327.09              |163.55              |162.82              |164.27              |164.27                  |164.27                  |164.27                   |164.27                  |164.27                  |164.27                   |164.27                  |164.27                  |164.27                   |247.52               |123.76               |56.43                |191.09               |NULL                     |NULL                     |NULL                      |NULL                     |NULL                     |NULL                      |NULL                     |NULL                     |NULL                      |105.81            |52.91             |41.91             |63.9              |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |317.38                 |105.79                 |46.79                  |173.16                 |97.44                      |97.44                      |105.79                      |97.44                      |97.44                      |46.79                       |97.44                      |97.44                      |173.16                      |0.0               |NULL              |NULL              |NULL              |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |1.0                        |1.0                         |NULL                       |NULL                        |NULL                       |NULL                        |1.0                        |0.92                        |NULL                       |NULL                        |
+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+
only showing top 3 rows

None
</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>Teste de sanidade - total de registros na base variaveis explicativas de Segunda Camada
1000

+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+
|ID_CLIENTE|VL_TOT_CONSUMO|VL_MED_CONSUMO|VL_MAX_CONSUMO|VL_MIN_CONSUMO|VL_TOT_CONS_ESPORTES|VL_MED_CONS_ESPORTES|VL_MIN_CONS_ESPORTES|VL_MAX_CONS_ESPORTES|VL_MED_U3M_CONS_ESPORTES|VL_MED_U6M_CONS_ESPORTES|VL_MED_U12M_CONS_ESPORTES|VL_MIN_U3M_CONS_ESPORTES|VL_MIN_U6M_CONS_ESPORTES|VL_MIN_U12M_CONS_ESPORTES|VL_MAX_U3M_CONS_ESPORTES|VL_MAX_U6M_CONS_ESPORTES|VL_MAX_U12M_CONS_ESPORTES|VL_TOT_CONS_ALIMENTOS|VL_MED_CONS_ALIMENTOS|VL_MIN_CONS_ALIMENTOS|VL_MAX_CONS_ALIMENTOS|VL_MED_U3M_CONS_ALIMENTOS|VL_MED_U6M_CONS_ALIMENTOS|VL_MED_U12M_CONS_ALIMENTOS|VL_MIN_U3M_CONS_ALIMENTOS|VL_MIN_U6M_CONS_ALIMENTOS|VL_MIN_U12M_CONS_ALIMENTOS|VL_MAX_U3M_CONS_ALIMENTOS|VL_MAX_U6M_CONS_ALIMENTOS|VL_MAX_U12M_CONS_ALIMENTOS|VL_TOT_CONS_LIVROS|VL_MED_CONS_LIVROS|VL_MIN_CONS_LIVROS|VL_MAX_CONS_LIVROS|VL_MED_U3M_CONS_LIVROS|VL_MED_U6M_CONS_LIVROS|VL_MED_U12M_CONS_LIVROS|VL_MIN_U3M_CONS_LIVROS|VL_MIN_U6M_CONS_LIVROS|VL_MIN_U12M_CONS_LIVROS|VL_MAX_U3M_CONS_LIVROS|VL_MAX_U6M_CONS_LIVROS|VL_MAX_U12M_CONS_LIVROS|VL_TOT_CONS_ELETRONICOS|VL_MED_CONS_ELETRONICOS|VL_MIN_CONS_ELETRONICOS|VL_MAX_CONS_ELETRONICOS|VL_MED_U3M_CONS_ELETRONICOS|VL_MED_U6M_CONS_ELETRONICOS|VL_MED_U12M_CONS_ELETRONICOS|VL_MIN_U3M_CONS_ELETRONICOS|VL_MIN_U6M_CONS_ELETRONICOS|VL_MIN_U12M_CONS_ELETRONICOS|VL_MAX_U3M_CONS_ELETRONICOS|VL_MAX_U6M_CONS_ELETRONICOS|VL_MAX_U12M_CONS_ELETRONICOS|VL_TOT_CONS_ROUPAS|VL_MED_CONS_ROUPAS|VL_MIN_CONS_ROUPAS|VL_MAX_CONS_ROUPAS|VL_MED_U3M_CONS_ROUPAS|VL_MED_U6M_CONS_ROUPAS|VL_MED_U12M_CONS_ROUPAS|VL_MIN_U3M_CONS_ROUPAS|VL_MIN_U6M_CONS_ROUPAS|VL_MIN_U12M_CONS_ROUPAS|VL_MAX_U3M_CONS_ROUPAS|VL_MAX_U6M_CONS_ROUPAS|VL_MAX_U12M_CONS_ROUPAS|VL_RAZ_MED_U3M_U6M_CONS_ESP|VL_RAZ_MED_U6M_U12M_CONS_ESP|VL_RAZ_MED_U3M_U6M_CONS_ALI|VL_RAZ_MED_U6M_U12M_CONS_ALI|VL_RAZ_MED_U3M_U6M_CONS_LIV|VL_RAZ_MED_U6M_U12M_CONS_LIV|VL_RAZ_MED_U3M_U6M_CONS_ELE|VL_RAZ_MED_U6M_U12M_CONS_ELE|VL_RAZ_MED_U3M_U6M_CONS_ROU|VL_RAZ_MED_U6M_U12M_CONS_ROU|
+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+
|1         |1976.56       |116.27        |199.39        |5.39          |226.73              |113.37              |57.29               |169.44              |57.29                   |57.29                   |57.29                    |57.29                   |57.29                   |57.29                    |57.29                   |57.29                   |57.29                    |351.26               |87.81                |9.84                 |187.82               |NULL                     |187.82                   |187.82                    |NULL                     |187.82                   |187.82                    |NULL                     |187.82                   |187.82                    |551.06            |183.69            |169.11            |193.01            |193.01                |193.01                |183.69                 |193.01                |193.01                |169.11                 |193.01                |193.01                |193.01                 |396.72                 |132.24                 |76.91                  |160.0                  |118.45                     |118.45                     |132.24                      |76.91                      |76.91                      |76.91                       |160.0                      |160.0                      |160.0                       |450.79            |90.16             |5.39              |199.39            |96.4                  |66.07                 |99.4                   |24.12                 |5.39                  |5.39                   |168.69                |168.69                |199.39                 |1.0                        |1.0                         |NULL                       |1.0                         |1.0                        |1.05                        |1.0                        |0.9                         |1.46                       |0.66                        |
|2         |1017.8        |101.78        |192.63        |47.58         |275.47              |91.82               |57.35               |111.9               |57.35                   |57.35                   |84.62                    |57.35                   |57.35                   |57.35                    |57.35                   |57.35                   |111.9                    |109.58               |54.79                |47.58                |62.0                 |47.58                    |54.79                    |54.79                     |47.58                    |47.58                    |47.58                     |47.58                    |62.0                     |62.0                      |340.59            |170.29            |147.96            |192.63            |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |292.16                 |97.39                  |69.05                  |123.23                 |NULL                       |69.05                      |69.05                       |NULL                       |69.05                      |69.05                       |NULL                       |69.05                      |69.05                       |0.0               |NULL              |NULL              |NULL              |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |1.0                        |0.68                        |0.87                       |1.0                         |NULL                       |NULL                        |NULL                       |1.0                         |NULL                       |NULL                        |
|3         |997.81        |110.87        |191.09        |41.91         |327.09              |163.55              |162.82              |164.27              |164.27                  |164.27                  |164.27                   |164.27                  |164.27                  |164.27                   |164.27                  |164.27                  |164.27                   |247.52               |123.76               |56.43                |191.09               |NULL                     |NULL                     |NULL                      |NULL                     |NULL                     |NULL                      |NULL                     |NULL                     |NULL                      |105.81            |52.91             |41.91             |63.9              |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |317.38                 |105.79                 |46.79                  |173.16                 |97.44                      |97.44                      |105.79                      |97.44                      |97.44                      |46.79                       |97.44                      |97.44                      |173.16                      |0.0               |NULL              |NULL              |NULL              |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |1.0                        |1.0                         |NULL                       |NULL                        |NULL                       |NULL                        |1.0                        |0.92                        |NULL                       |NULL                        |
+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+
only showing top 3 rows
</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#F3F2EE">
<h2 id="Trazer-as-vari%C3%A1veis-explicativas-para-a-base-de-p%C3%BAblico"><font color="#CC403E" face="Segoe Print" size="4"><strong>Trazer as variáveis explicativas para a base de público</strong></font><a class="anchor-link" href="#Trazer-as-vari%C3%A1veis-explicativas-para-a-base-de-p%C3%BAblico">¶</a></h2><font color="#66666" face="Segoe Print" size="3">
</font></div>
<div class="cell">
<div class="code_cell">
<pre>df_publico.printSchema()</pre>
</div>
<div class="output">
<pre>root
 |-- ID: integer (nullable = true)
 |-- IDADE: integer (nullable = true)
 |-- GENERO: string (nullable = true)
 |-- DIAS_DESDE_A_INSCRICAO: integer (nullable = true)
 |-- USOU_SUPORTE: integer (nullable = true)
 |-- PLANO: string (nullable = true)
 |-- CHURN: integer (nullable = true)

</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>abt_temp01 = spark.sql("""
SELECT
    pub.*,
    b.*,
    date_format(CURRENT_DATE, 'yyyyMM') AS PK_DATREF,
    CURRENT_DATE AS PK_DAT_PROC
FROM sql_publico AS pub
LEFT JOIN tmpview03 AS b
ON pub.ID = b.ID_CLIENTE
""")</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>print("Teste de sanidade - total de registros na base variaveis explicativas de Segunda Camada")
print(abt_temp01.count())
print()
print(abt_temp01.show(3,False))</pre>
</div>
<div class="output">
<pre>Teste de sanidade - total de registros na base variaveis explicativas de Segunda Camada
1000

+---+-----+------+----------------------+------------+-------------+-----+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------+-----------+
|ID |IDADE|GENERO|DIAS_DESDE_A_INSCRICAO|USOU_SUPORTE|PLANO        |CHURN|ID_CLIENTE|VL_TOT_CONSUMO|VL_MED_CONSUMO|VL_MAX_CONSUMO|VL_MIN_CONSUMO|VL_TOT_CONS_ESPORTES|VL_MED_CONS_ESPORTES|VL_MIN_CONS_ESPORTES|VL_MAX_CONS_ESPORTES|VL_MED_U3M_CONS_ESPORTES|VL_MED_U6M_CONS_ESPORTES|VL_MED_U12M_CONS_ESPORTES|VL_MIN_U3M_CONS_ESPORTES|VL_MIN_U6M_CONS_ESPORTES|VL_MIN_U12M_CONS_ESPORTES|VL_MAX_U3M_CONS_ESPORTES|VL_MAX_U6M_CONS_ESPORTES|VL_MAX_U12M_CONS_ESPORTES|VL_TOT_CONS_ALIMENTOS|VL_MED_CONS_ALIMENTOS|VL_MIN_CONS_ALIMENTOS|VL_MAX_CONS_ALIMENTOS|VL_MED_U3M_CONS_ALIMENTOS|VL_MED_U6M_CONS_ALIMENTOS|VL_MED_U12M_CONS_ALIMENTOS|VL_MIN_U3M_CONS_ALIMENTOS|VL_MIN_U6M_CONS_ALIMENTOS|VL_MIN_U12M_CONS_ALIMENTOS|VL_MAX_U3M_CONS_ALIMENTOS|VL_MAX_U6M_CONS_ALIMENTOS|VL_MAX_U12M_CONS_ALIMENTOS|VL_TOT_CONS_LIVROS|VL_MED_CONS_LIVROS|VL_MIN_CONS_LIVROS|VL_MAX_CONS_LIVROS|VL_MED_U3M_CONS_LIVROS|VL_MED_U6M_CONS_LIVROS|VL_MED_U12M_CONS_LIVROS|VL_MIN_U3M_CONS_LIVROS|VL_MIN_U6M_CONS_LIVROS|VL_MIN_U12M_CONS_LIVROS|VL_MAX_U3M_CONS_LIVROS|VL_MAX_U6M_CONS_LIVROS|VL_MAX_U12M_CONS_LIVROS|VL_TOT_CONS_ELETRONICOS|VL_MED_CONS_ELETRONICOS|VL_MIN_CONS_ELETRONICOS|VL_MAX_CONS_ELETRONICOS|VL_MED_U3M_CONS_ELETRONICOS|VL_MED_U6M_CONS_ELETRONICOS|VL_MED_U12M_CONS_ELETRONICOS|VL_MIN_U3M_CONS_ELETRONICOS|VL_MIN_U6M_CONS_ELETRONICOS|VL_MIN_U12M_CONS_ELETRONICOS|VL_MAX_U3M_CONS_ELETRONICOS|VL_MAX_U6M_CONS_ELETRONICOS|VL_MAX_U12M_CONS_ELETRONICOS|VL_TOT_CONS_ROUPAS|VL_MED_CONS_ROUPAS|VL_MIN_CONS_ROUPAS|VL_MAX_CONS_ROUPAS|VL_MED_U3M_CONS_ROUPAS|VL_MED_U6M_CONS_ROUPAS|VL_MED_U12M_CONS_ROUPAS|VL_MIN_U3M_CONS_ROUPAS|VL_MIN_U6M_CONS_ROUPAS|VL_MIN_U12M_CONS_ROUPAS|VL_MAX_U3M_CONS_ROUPAS|VL_MAX_U6M_CONS_ROUPAS|VL_MAX_U12M_CONS_ROUPAS|VL_RAZ_MED_U3M_U6M_CONS_ESP|VL_RAZ_MED_U6M_U12M_CONS_ESP|VL_RAZ_MED_U3M_U6M_CONS_ALI|VL_RAZ_MED_U6M_U12M_CONS_ALI|VL_RAZ_MED_U3M_U6M_CONS_LIV|VL_RAZ_MED_U6M_U12M_CONS_LIV|VL_RAZ_MED_U3M_U6M_CONS_ELE|VL_RAZ_MED_U6M_U12M_CONS_ELE|VL_RAZ_MED_U3M_U6M_CONS_ROU|VL_RAZ_MED_U6M_U12M_CONS_ROU|PK_DATREF|PK_DAT_PROC|
+---+-----+------+----------------------+------------+-------------+-----+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------+-----------+
|1  |21   |F     |1331                  |1           |Intermediário|1    |1         |1976.56       |116.27        |199.39        |5.39          |226.73              |113.37              |57.29               |169.44              |57.29                   |57.29                   |57.29                    |57.29                   |57.29                   |57.29                    |57.29                   |57.29                   |57.29                    |351.26               |87.81                |9.84                 |187.82               |NULL                     |187.82                   |187.82                    |NULL                     |187.82                   |187.82                    |NULL                     |187.82                   |187.82                    |551.06            |183.69            |169.11            |193.01            |193.01                |193.01                |183.69                 |193.01                |193.01                |169.11                 |193.01                |193.01                |193.01                 |396.72                 |132.24                 |76.91                  |160.0                  |118.45                     |118.45                     |132.24                      |76.91                      |76.91                      |76.91                       |160.0                      |160.0                      |160.0                       |450.79            |90.16             |5.39              |199.39            |96.4                  |66.07                 |99.4                   |24.12                 |5.39                  |5.39                   |168.69                |168.69                |199.39                 |1.0                        |1.0                         |NULL                       |1.0                         |1.0                        |1.05                        |1.0                        |0.9                         |1.46                       |0.66                        |202408   |2024-08-30 |
|2  |21   |M     |1160                  |0           |Intermediário|0    |2         |1017.8        |101.78        |192.63        |47.58         |275.47              |91.82               |57.35               |111.9               |57.35                   |57.35                   |84.62                    |57.35                   |57.35                   |57.35                    |57.35                   |57.35                   |111.9                    |109.58               |54.79                |47.58                |62.0                 |47.58                    |54.79                    |54.79                     |47.58                    |47.58                    |47.58                     |47.58                    |62.0                     |62.0                      |340.59            |170.29            |147.96            |192.63            |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |292.16                 |97.39                  |69.05                  |123.23                 |NULL                       |69.05                      |69.05                       |NULL                       |69.05                      |69.05                       |NULL                       |69.05                      |69.05                       |0.0               |NULL              |NULL              |NULL              |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |1.0                        |0.68                        |0.87                       |1.0                         |NULL                       |NULL                        |NULL                       |1.0                         |NULL                       |NULL                        |202408   |2024-08-30 |
|3  |62   |M     |454                   |1           |Básico       |0    |3         |997.81        |110.87        |191.09        |41.91         |327.09              |163.55              |162.82              |164.27              |164.27                  |164.27                  |164.27                   |164.27                  |164.27                  |164.27                   |164.27                  |164.27                  |164.27                   |247.52               |123.76               |56.43                |191.09               |NULL                     |NULL                     |NULL                      |NULL                     |NULL                     |NULL                      |NULL                     |NULL                     |NULL                      |105.81            |52.91             |41.91             |63.9              |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |317.38                 |105.79                 |46.79                  |173.16                 |97.44                      |97.44                      |105.79                      |97.44                      |97.44                      |46.79                       |97.44                      |97.44                      |173.16                      |0.0               |NULL              |NULL              |NULL              |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |1.0                        |1.0                         |NULL                       |NULL                        |NULL                       |NULL                        |1.0                        |0.92                        |NULL                       |NULL                        |202408   |2024-08-30 |
+---+-----+------+----------------------+------------+-------------+-----+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------+-----------+
only showing top 3 rows

None
</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>+---+-----+------+----------------------+------------+-------------+-----+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------+-----------+
|ID |IDADE|GENERO|DIAS_DESDE_A_INSCRICAO|USOU_SUPORTE|PLANO        |CHURN|ID_CLIENTE|VL_TOT_CONSUMO|VL_MED_CONSUMO|VL_MAX_CONSUMO|VL_MIN_CONSUMO|VL_TOT_CONS_ESPORTES|VL_MED_CONS_ESPORTES|VL_MIN_CONS_ESPORTES|VL_MAX_CONS_ESPORTES|VL_MED_U3M_CONS_ESPORTES|VL_MED_U6M_CONS_ESPORTES|VL_MED_U12M_CONS_ESPORTES|VL_MIN_U3M_CONS_ESPORTES|VL_MIN_U6M_CONS_ESPORTES|VL_MIN_U12M_CONS_ESPORTES|VL_MAX_U3M_CONS_ESPORTES|VL_MAX_U6M_CONS_ESPORTES|VL_MAX_U12M_CONS_ESPORTES|VL_TOT_CONS_ALIMENTOS|VL_MED_CONS_ALIMENTOS|VL_MIN_CONS_ALIMENTOS|VL_MAX_CONS_ALIMENTOS|VL_MED_U3M_CONS_ALIMENTOS|VL_MED_U6M_CONS_ALIMENTOS|VL_MED_U12M_CONS_ALIMENTOS|VL_MIN_U3M_CONS_ALIMENTOS|VL_MIN_U6M_CONS_ALIMENTOS|VL_MIN_U12M_CONS_ALIMENTOS|VL_MAX_U3M_CONS_ALIMENTOS|VL_MAX_U6M_CONS_ALIMENTOS|VL_MAX_U12M_CONS_ALIMENTOS|VL_TOT_CONS_LIVROS|VL_MED_CONS_LIVROS|VL_MIN_CONS_LIVROS|VL_MAX_CONS_LIVROS|VL_MED_U3M_CONS_LIVROS|VL_MED_U6M_CONS_LIVROS|VL_MED_U12M_CONS_LIVROS|VL_MIN_U3M_CONS_LIVROS|VL_MIN_U6M_CONS_LIVROS|VL_MIN_U12M_CONS_LIVROS|VL_MAX_U3M_CONS_LIVROS|VL_MAX_U6M_CONS_LIVROS|VL_MAX_U12M_CONS_LIVROS|VL_TOT_CONS_ELETRONICOS|VL_MED_CONS_ELETRONICOS|VL_MIN_CONS_ELETRONICOS|VL_MAX_CONS_ELETRONICOS|VL_MED_U3M_CONS_ELETRONICOS|VL_MED_U6M_CONS_ELETRONICOS|VL_MED_U12M_CONS_ELETRONICOS|VL_MIN_U3M_CONS_ELETRONICOS|VL_MIN_U6M_CONS_ELETRONICOS|VL_MIN_U12M_CONS_ELETRONICOS|VL_MAX_U3M_CONS_ELETRONICOS|VL_MAX_U6M_CONS_ELETRONICOS|VL_MAX_U12M_CONS_ELETRONICOS|VL_TOT_CONS_ROUPAS|VL_MED_CONS_ROUPAS|VL_MIN_CONS_ROUPAS|VL_MAX_CONS_ROUPAS|VL_MED_U3M_CONS_ROUPAS|VL_MED_U6M_CONS_ROUPAS|VL_MED_U12M_CONS_ROUPAS|VL_MIN_U3M_CONS_ROUPAS|VL_MIN_U6M_CONS_ROUPAS|VL_MIN_U12M_CONS_ROUPAS|VL_MAX_U3M_CONS_ROUPAS|VL_MAX_U6M_CONS_ROUPAS|VL_MAX_U12M_CONS_ROUPAS|VL_RAZ_MED_U3M_U6M_CONS_ESP|VL_RAZ_MED_U6M_U12M_CONS_ESP|VL_RAZ_MED_U3M_U6M_CONS_ALI|VL_RAZ_MED_U6M_U12M_CONS_ALI|VL_RAZ_MED_U3M_U6M_CONS_LIV|VL_RAZ_MED_U6M_U12M_CONS_LIV|VL_RAZ_MED_U3M_U6M_CONS_ELE|VL_RAZ_MED_U6M_U12M_CONS_ELE|VL_RAZ_MED_U3M_U6M_CONS_ROU|VL_RAZ_MED_U6M_U12M_CONS_ROU|PK_DATREF|PK_DAT_PROC|
+---+-----+------+----------------------+------------+-------------+-----+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------+-----------+
|1  |21   |F     |1331                  |1           |Intermediário|1    |1         |1976.56       |116.27        |199.39        |5.39          |226.73              |113.37              |57.29               |169.44              |57.29                   |57.29                   |57.29                    |57.29                   |57.29                   |57.29                    |57.29                   |57.29                   |57.29                    |351.26               |87.81                |9.84                 |187.82               |NULL                     |187.82                   |187.82                    |NULL                     |187.82                   |187.82                    |NULL                     |187.82                   |187.82                    |551.06            |183.69            |169.11            |193.01            |193.01                |193.01                |183.69                 |193.01                |193.01                |169.11                 |193.01                |193.01                |193.01                 |396.72                 |132.24                 |76.91                  |160.0                  |118.45                     |118.45                     |132.24                      |76.91                      |76.91                      |76.91                       |160.0                      |160.0                      |160.0                       |450.79            |90.16             |5.39              |199.39            |96.4                  |66.07                 |99.4                   |24.12                 |5.39                  |5.39                   |168.69                |168.69                |199.39                 |1.0                        |1.0                         |NULL                       |1.0                         |1.0                        |1.05                        |1.0                        |0.9                         |1.46                       |0.66                        |202408   |2024-08-30 |
|2  |21   |M     |1160                  |0           |Intermediário|0    |2         |1017.8        |101.78        |192.63        |47.58         |275.47              |91.82               |57.35               |111.9               |57.35                   |57.35                   |84.62                    |57.35                   |57.35                   |57.35                    |57.35                   |57.35                   |111.9                    |109.58               |54.79                |47.58                |62.0                 |47.58                    |54.79                    |54.79                     |47.58                    |47.58                    |47.58                     |47.58                    |62.0                     |62.0                      |340.59            |170.29            |147.96            |192.63            |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |292.16                 |97.39                  |69.05                  |123.23                 |NULL                       |69.05                      |69.05                       |NULL                       |69.05                      |69.05                       |NULL                       |69.05                      |69.05                       |0.0               |NULL              |NULL              |NULL              |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |1.0                        |0.68                        |0.87                       |1.0                         |NULL                       |NULL                        |NULL                       |1.0                         |NULL                       |NULL                        |202408   |2024-08-30 |
|3  |62   |M     |454                   |1           |Básico       |0    |3         |997.81        |110.87        |191.09        |41.91         |327.09              |163.55              |162.82              |164.27              |164.27                  |164.27                  |164.27                   |164.27                  |164.27                  |164.27                   |164.27                  |164.27                  |164.27                   |247.52               |123.76               |56.43                |191.09               |NULL                     |NULL                     |NULL                      |NULL                     |NULL                     |NULL                      |NULL                     |NULL                     |NULL                      |105.81            |52.91             |41.91             |63.9              |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |317.38                 |105.79                 |46.79                  |173.16                 |97.44                      |97.44                      |105.79                      |97.44                      |97.44                      |46.79                       |97.44                      |97.44                      |173.16                      |0.0               |NULL              |NULL              |NULL              |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |NULL                  |NULL                  |NULL                   |1.0                        |1.0                         |NULL                       |NULL                        |NULL                       |NULL                        |1.0                        |0.92                        |NULL                       |NULL                        |202408   |2024-08-30 |
+---+-----+------+----------------------+------------+-------------+-----+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------+-----------+
only showing top 3 rows

None
</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>abt_temp01.printSchema()</pre>
</div>
<div class="output">
<pre>root
 |-- ID: integer (nullable = true)
 |-- IDADE: integer (nullable = true)
 |-- GENERO: string (nullable = true)
 |-- DIAS_DESDE_A_INSCRICAO: integer (nullable = true)
 |-- USOU_SUPORTE: integer (nullable = true)
 |-- PLANO: string (nullable = true)
 |-- CHURN: integer (nullable = true)
 |-- ID_CLIENTE: integer (nullable = true)
 |-- VL_TOT_CONSUMO: double (nullable = true)
 |-- VL_MED_CONSUMO: double (nullable = true)
 |-- VL_MAX_CONSUMO: double (nullable = true)
 |-- VL_MIN_CONSUMO: double (nullable = true)
 |-- VL_TOT_CONS_ESPORTES: double (nullable = true)
 |-- VL_MED_CONS_ESPORTES: double (nullable = true)
 |-- VL_MIN_CONS_ESPORTES: double (nullable = true)
 |-- VL_MAX_CONS_ESPORTES: double (nullable = true)
 |-- VL_MED_U3M_CONS_ESPORTES: double (nullable = true)
 |-- VL_MED_U6M_CONS_ESPORTES: double (nullable = true)
 |-- VL_MED_U12M_CONS_ESPORTES: double (nullable = true)
 |-- VL_MIN_U3M_CONS_ESPORTES: double (nullable = true)
 |-- VL_MIN_U6M_CONS_ESPORTES: double (nullable = true)
 |-- VL_MIN_U12M_CONS_ESPORTES: double (nullable = true)
 |-- VL_MAX_U3M_CONS_ESPORTES: double (nullable = true)
 |-- VL_MAX_U6M_CONS_ESPORTES: double (nullable = true)
 |-- VL_MAX_U12M_CONS_ESPORTES: double (nullable = true)
 |-- VL_TOT_CONS_ALIMENTOS: double (nullable = true)
 |-- VL_MED_CONS_ALIMENTOS: double (nullable = true)
 |-- VL_MIN_CONS_ALIMENTOS: double (nullable = true)
 |-- VL_MAX_CONS_ALIMENTOS: double (nullable = true)
 |-- VL_MED_U3M_CONS_ALIMENTOS: double (nullable = true)
 |-- VL_MED_U6M_CONS_ALIMENTOS: double (nullable = true)
 |-- VL_MED_U12M_CONS_ALIMENTOS: double (nullable = true)
 |-- VL_MIN_U3M_CONS_ALIMENTOS: double (nullable = true)
 |-- VL_MIN_U6M_CONS_ALIMENTOS: double (nullable = true)
 |-- VL_MIN_U12M_CONS_ALIMENTOS: double (nullable = true)
 |-- VL_MAX_U3M_CONS_ALIMENTOS: double (nullable = true)
 |-- VL_MAX_U6M_CONS_ALIMENTOS: double (nullable = true)
 |-- VL_MAX_U12M_CONS_ALIMENTOS: double (nullable = true)
 |-- VL_TOT_CONS_LIVROS: double (nullable = true)
 |-- VL_MED_CONS_LIVROS: double (nullable = true)
 |-- VL_MIN_CONS_LIVROS: double (nullable = true)
 |-- VL_MAX_CONS_LIVROS: double (nullable = true)
 |-- VL_MED_U3M_CONS_LIVROS: double (nullable = true)
 |-- VL_MED_U6M_CONS_LIVROS: double (nullable = true)
 |-- VL_MED_U12M_CONS_LIVROS: double (nullable = true)
 |-- VL_MIN_U3M_CONS_LIVROS: double (nullable = true)
 |-- VL_MIN_U6M_CONS_LIVROS: double (nullable = true)
 |-- VL_MIN_U12M_CONS_LIVROS: double (nullable = true)
 |-- VL_MAX_U3M_CONS_LIVROS: double (nullable = true)
 |-- VL_MAX_U6M_CONS_LIVROS: double (nullable = true)
 |-- VL_MAX_U12M_CONS_LIVROS: double (nullable = true)
 |-- VL_TOT_CONS_ELETRONICOS: double (nullable = true)
 |-- VL_MED_CONS_ELETRONICOS: double (nullable = true)
 |-- VL_MIN_CONS_ELETRONICOS: double (nullable = true)
 |-- VL_MAX_CONS_ELETRONICOS: double (nullable = true)
 |-- VL_MED_U3M_CONS_ELETRONICOS: double (nullable = true)
 |-- VL_MED_U6M_CONS_ELETRONICOS: double (nullable = true)
 |-- VL_MED_U12M_CONS_ELETRONICOS: double (nullable = true)
 |-- VL_MIN_U3M_CONS_ELETRONICOS: double (nullable = true)
 |-- VL_MIN_U6M_CONS_ELETRONICOS: double (nullable = true)
 |-- VL_MIN_U12M_CONS_ELETRONICOS: double (nullable = true)
 |-- VL_MAX_U3M_CONS_ELETRONICOS: double (nullable = true)
 |-- VL_MAX_U6M_CONS_ELETRONICOS: double (nullable = true)
 |-- VL_MAX_U12M_CONS_ELETRONICOS: double (nullable = true)
 |-- VL_TOT_CONS_ROUPAS: double (nullable = true)
 |-- VL_MED_CONS_ROUPAS: double (nullable = true)
 |-- VL_MIN_CONS_ROUPAS: double (nullable = true)
 |-- VL_MAX_CONS_ROUPAS: double (nullable = true)
 |-- VL_MED_U3M_CONS_ROUPAS: double (nullable = true)
 |-- VL_MED_U6M_CONS_ROUPAS: double (nullable = true)
 |-- VL_MED_U12M_CONS_ROUPAS: double (nullable = true)
 |-- VL_MIN_U3M_CONS_ROUPAS: double (nullable = true)
 |-- VL_MIN_U6M_CONS_ROUPAS: double (nullable = true)
 |-- VL_MIN_U12M_CONS_ROUPAS: double (nullable = true)
 |-- VL_MAX_U3M_CONS_ROUPAS: double (nullable = true)
 |-- VL_MAX_U6M_CONS_ROUPAS: double (nullable = true)
 |-- VL_MAX_U12M_CONS_ROUPAS: double (nullable = true)
 |-- VL_RAZ_MED_U3M_U6M_CONS_ESP: double (nullable = true)
 |-- VL_RAZ_MED_U6M_U12M_CONS_ESP: double (nullable = true)
 |-- VL_RAZ_MED_U3M_U6M_CONS_ALI: double (nullable = true)
 |-- VL_RAZ_MED_U6M_U12M_CONS_ALI: double (nullable = true)
 |-- VL_RAZ_MED_U3M_U6M_CONS_LIV: double (nullable = true)
 |-- VL_RAZ_MED_U6M_U12M_CONS_LIV: double (nullable = true)
 |-- VL_RAZ_MED_U3M_U6M_CONS_ELE: double (nullable = true)
 |-- VL_RAZ_MED_U6M_U12M_CONS_ELE: double (nullable = true)
 |-- VL_RAZ_MED_U3M_U6M_CONS_ROU: double (nullable = true)
 |-- VL_RAZ_MED_U6M_U12M_CONS_ROU: double (nullable = true)
 |-- PK_DATREF: string (nullable = false)
 |-- PK_DAT_PROC: date (nullable = false)

</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#F3F2EE">
<h2 id="Renomear-algumas-vari%C3%A1veis-com-pyspark:"><font color="#CC403E" face="Segoe Print" size="3"><strong>Renomear algumas variáveis com pyspark:</strong></font><a class="anchor-link" href="#Renomear-algumas-vari%C3%A1veis-com-pyspark:">¶</a></h2><font color="#66666" face="Segoe Print" size="3">
</font></div>
<div class="cell">
<div class="code_cell">
<pre># Dicionário de renomeação
rename_dict = {
    "IDADE":"VL_IDADE",
    "GENERO":"NM_GENERO",
    "DIAS_DESDE_A_INSCRICAO":"QT_DIAS_DESDE_INSCR",
    "USOU_SUPORTE":"FL_USOU_SUPORTE",
    "PLANO":"NM_PLANO",
    "CHURN":"TARGET_CHURN"
}

# Aplicando renomeações
for old_name, new_name in rename_dict.items():
    abt_temp01 = abt_temp01.withColumnRenamed(old_name, new_name)</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#F3F2EE">
<h2 id="Dropar-a-coluna-ID-porque-ela-j%C3%A1-esta-sendo-representada-por-ID_CLIENTE"><font color="#CC403E" face="Segoe Print" size="3"><strong>Dropar a coluna ID porque ela já esta sendo representada por ID_CLIENTE</strong></font><a class="anchor-link" href="#Dropar-a-coluna-ID-porque-ela-j%C3%A1-esta-sendo-representada-por-ID_CLIENTE">¶</a></h2><font color="#66666" face="Segoe Print" size="3">
</font></div>
<div class="cell">
<div class="code_cell">
<pre>abt = abt_temp01.drop("ID")
abt.count()</pre>
</div>
<div class="output">
<pre>1000</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>abt.show(3)</pre>
</div>
<div class="output">
<pre>+--------+---------+-------------------+---------------+-------------+------------+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------+-----------+
|VL_IDADE|NM_GENERO|QT_DIAS_DESDE_INSCR|FL_USOU_SUPORTE|     NM_PLANO|TARGET_CHURN|ID_CLIENTE|VL_TOT_CONSUMO|VL_MED_CONSUMO|VL_MAX_CONSUMO|VL_MIN_CONSUMO|VL_TOT_CONS_ESPORTES|VL_MED_CONS_ESPORTES|VL_MIN_CONS_ESPORTES|VL_MAX_CONS_ESPORTES|VL_MED_U3M_CONS_ESPORTES|VL_MED_U6M_CONS_ESPORTES|VL_MED_U12M_CONS_ESPORTES|VL_MIN_U3M_CONS_ESPORTES|VL_MIN_U6M_CONS_ESPORTES|VL_MIN_U12M_CONS_ESPORTES|VL_MAX_U3M_CONS_ESPORTES|VL_MAX_U6M_CONS_ESPORTES|VL_MAX_U12M_CONS_ESPORTES|VL_TOT_CONS_ALIMENTOS|VL_MED_CONS_ALIMENTOS|VL_MIN_CONS_ALIMENTOS|VL_MAX_CONS_ALIMENTOS|VL_MED_U3M_CONS_ALIMENTOS|VL_MED_U6M_CONS_ALIMENTOS|VL_MED_U12M_CONS_ALIMENTOS|VL_MIN_U3M_CONS_ALIMENTOS|VL_MIN_U6M_CONS_ALIMENTOS|VL_MIN_U12M_CONS_ALIMENTOS|VL_MAX_U3M_CONS_ALIMENTOS|VL_MAX_U6M_CONS_ALIMENTOS|VL_MAX_U12M_CONS_ALIMENTOS|VL_TOT_CONS_LIVROS|VL_MED_CONS_LIVROS|VL_MIN_CONS_LIVROS|VL_MAX_CONS_LIVROS|VL_MED_U3M_CONS_LIVROS|VL_MED_U6M_CONS_LIVROS|VL_MED_U12M_CONS_LIVROS|VL_MIN_U3M_CONS_LIVROS|VL_MIN_U6M_CONS_LIVROS|VL_MIN_U12M_CONS_LIVROS|VL_MAX_U3M_CONS_LIVROS|VL_MAX_U6M_CONS_LIVROS|VL_MAX_U12M_CONS_LIVROS|VL_TOT_CONS_ELETRONICOS|VL_MED_CONS_ELETRONICOS|VL_MIN_CONS_ELETRONICOS|VL_MAX_CONS_ELETRONICOS|VL_MED_U3M_CONS_ELETRONICOS|VL_MED_U6M_CONS_ELETRONICOS|VL_MED_U12M_CONS_ELETRONICOS|VL_MIN_U3M_CONS_ELETRONICOS|VL_MIN_U6M_CONS_ELETRONICOS|VL_MIN_U12M_CONS_ELETRONICOS|VL_MAX_U3M_CONS_ELETRONICOS|VL_MAX_U6M_CONS_ELETRONICOS|VL_MAX_U12M_CONS_ELETRONICOS|VL_TOT_CONS_ROUPAS|VL_MED_CONS_ROUPAS|VL_MIN_CONS_ROUPAS|VL_MAX_CONS_ROUPAS|VL_MED_U3M_CONS_ROUPAS|VL_MED_U6M_CONS_ROUPAS|VL_MED_U12M_CONS_ROUPAS|VL_MIN_U3M_CONS_ROUPAS|VL_MIN_U6M_CONS_ROUPAS|VL_MIN_U12M_CONS_ROUPAS|VL_MAX_U3M_CONS_ROUPAS|VL_MAX_U6M_CONS_ROUPAS|VL_MAX_U12M_CONS_ROUPAS|VL_RAZ_MED_U3M_U6M_CONS_ESP|VL_RAZ_MED_U6M_U12M_CONS_ESP|VL_RAZ_MED_U3M_U6M_CONS_ALI|VL_RAZ_MED_U6M_U12M_CONS_ALI|VL_RAZ_MED_U3M_U6M_CONS_LIV|VL_RAZ_MED_U6M_U12M_CONS_LIV|VL_RAZ_MED_U3M_U6M_CONS_ELE|VL_RAZ_MED_U6M_U12M_CONS_ELE|VL_RAZ_MED_U3M_U6M_CONS_ROU|VL_RAZ_MED_U6M_U12M_CONS_ROU|PK_DATREF|PK_DAT_PROC|
+--------+---------+-------------------+---------------+-------------+------------+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------+-----------+
|      21|        F|               1331|              1|Intermediário|           1|         1|       1976.56|        116.27|        199.39|          5.39|              226.73|              113.37|               57.29|              169.44|                   57.29|                   57.29|                    57.29|                   57.29|                   57.29|                    57.29|                   57.29|                   57.29|                    57.29|               351.26|                87.81|                 9.84|               187.82|                     NULL|                   187.82|                    187.82|                     NULL|                   187.82|                    187.82|                     NULL|                   187.82|                    187.82|            551.06|            183.69|            169.11|            193.01|                193.01|                193.01|                 183.69|                193.01|                193.01|                 169.11|                193.01|                193.01|                 193.01|                 396.72|                 132.24|                  76.91|                  160.0|                     118.45|                     118.45|                      132.24|                      76.91|                      76.91|                       76.91|                      160.0|                      160.0|                       160.0|            450.79|             90.16|              5.39|            199.39|                  96.4|                 66.07|                   99.4|                 24.12|                  5.39|                   5.39|                168.69|                168.69|                 199.39|                        1.0|                         1.0|                       NULL|                         1.0|                        1.0|                        1.05|                        1.0|                         0.9|                       1.46|                        0.66|   202408| 2024-08-30|
|      21|        M|               1160|              0|Intermediário|           0|         2|        1017.8|        101.78|        192.63|         47.58|              275.47|               91.82|               57.35|               111.9|                   57.35|                   57.35|                    84.62|                   57.35|                   57.35|                    57.35|                   57.35|                   57.35|                    111.9|               109.58|                54.79|                47.58|                 62.0|                    47.58|                    54.79|                     54.79|                    47.58|                    47.58|                     47.58|                    47.58|                     62.0|                      62.0|            340.59|            170.29|            147.96|            192.63|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                 292.16|                  97.39|                  69.05|                 123.23|                       NULL|                      69.05|                       69.05|                       NULL|                      69.05|                       69.05|                       NULL|                      69.05|                       69.05|               0.0|              NULL|              NULL|              NULL|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                        1.0|                        0.68|                       0.87|                         1.0|                       NULL|                        NULL|                       NULL|                         1.0|                       NULL|                        NULL|   202408| 2024-08-30|
|      62|        M|                454|              1|       Básico|           0|         3|        997.81|        110.87|        191.09|         41.91|              327.09|              163.55|              162.82|              164.27|                  164.27|                  164.27|                   164.27|                  164.27|                  164.27|                   164.27|                  164.27|                  164.27|                   164.27|               247.52|               123.76|                56.43|               191.09|                     NULL|                     NULL|                      NULL|                     NULL|                     NULL|                      NULL|                     NULL|                     NULL|                      NULL|            105.81|             52.91|             41.91|              63.9|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                 317.38|                 105.79|                  46.79|                 173.16|                      97.44|                      97.44|                      105.79|                      97.44|                      97.44|                       46.79|                      97.44|                      97.44|                      173.16|               0.0|              NULL|              NULL|              NULL|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                        1.0|                         1.0|                       NULL|                        NULL|                       NULL|                        NULL|                        1.0|                        0.92|                       NULL|                        NULL|   202408| 2024-08-30|
+--------+---------+-------------------+---------------+-------------+------------+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------+-----------+
only showing top 3 rows

</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>+--------+---------+-------------------+---------------+-------------+------------+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------+-----------+
|VL_IDADE|NM_GENERO|QT_DIAS_DESDE_INSCR|FL_USOU_SUPORTE|     NM_PLANO|TARGET_CHURN|ID_CLIENTE|VL_TOT_CONSUMO|VL_MED_CONSUMO|VL_MAX_CONSUMO|VL_MIN_CONSUMO|VL_TOT_CONS_ESPORTES|VL_MED_CONS_ESPORTES|VL_MIN_CONS_ESPORTES|VL_MAX_CONS_ESPORTES|VL_MED_U3M_CONS_ESPORTES|VL_MED_U6M_CONS_ESPORTES|VL_MED_U12M_CONS_ESPORTES|VL_MIN_U3M_CONS_ESPORTES|VL_MIN_U6M_CONS_ESPORTES|VL_MIN_U12M_CONS_ESPORTES|VL_MAX_U3M_CONS_ESPORTES|VL_MAX_U6M_CONS_ESPORTES|VL_MAX_U12M_CONS_ESPORTES|VL_TOT_CONS_ALIMENTOS|VL_MED_CONS_ALIMENTOS|VL_MIN_CONS_ALIMENTOS|VL_MAX_CONS_ALIMENTOS|VL_MED_U3M_CONS_ALIMENTOS|VL_MED_U6M_CONS_ALIMENTOS|VL_MED_U12M_CONS_ALIMENTOS|VL_MIN_U3M_CONS_ALIMENTOS|VL_MIN_U6M_CONS_ALIMENTOS|VL_MIN_U12M_CONS_ALIMENTOS|VL_MAX_U3M_CONS_ALIMENTOS|VL_MAX_U6M_CONS_ALIMENTOS|VL_MAX_U12M_CONS_ALIMENTOS|VL_TOT_CONS_LIVROS|VL_MED_CONS_LIVROS|VL_MIN_CONS_LIVROS|VL_MAX_CONS_LIVROS|VL_MED_U3M_CONS_LIVROS|VL_MED_U6M_CONS_LIVROS|VL_MED_U12M_CONS_LIVROS|VL_MIN_U3M_CONS_LIVROS|VL_MIN_U6M_CONS_LIVROS|VL_MIN_U12M_CONS_LIVROS|VL_MAX_U3M_CONS_LIVROS|VL_MAX_U6M_CONS_LIVROS|VL_MAX_U12M_CONS_LIVROS|VL_TOT_CONS_ELETRONICOS|VL_MED_CONS_ELETRONICOS|VL_MIN_CONS_ELETRONICOS|VL_MAX_CONS_ELETRONICOS|VL_MED_U3M_CONS_ELETRONICOS|VL_MED_U6M_CONS_ELETRONICOS|VL_MED_U12M_CONS_ELETRONICOS|VL_MIN_U3M_CONS_ELETRONICOS|VL_MIN_U6M_CONS_ELETRONICOS|VL_MIN_U12M_CONS_ELETRONICOS|VL_MAX_U3M_CONS_ELETRONICOS|VL_MAX_U6M_CONS_ELETRONICOS|VL_MAX_U12M_CONS_ELETRONICOS|VL_TOT_CONS_ROUPAS|VL_MED_CONS_ROUPAS|VL_MIN_CONS_ROUPAS|VL_MAX_CONS_ROUPAS|VL_MED_U3M_CONS_ROUPAS|VL_MED_U6M_CONS_ROUPAS|VL_MED_U12M_CONS_ROUPAS|VL_MIN_U3M_CONS_ROUPAS|VL_MIN_U6M_CONS_ROUPAS|VL_MIN_U12M_CONS_ROUPAS|VL_MAX_U3M_CONS_ROUPAS|VL_MAX_U6M_CONS_ROUPAS|VL_MAX_U12M_CONS_ROUPAS|VL_RAZ_MED_U3M_U6M_CONS_ESP|VL_RAZ_MED_U6M_U12M_CONS_ESP|VL_RAZ_MED_U3M_U6M_CONS_ALI|VL_RAZ_MED_U6M_U12M_CONS_ALI|VL_RAZ_MED_U3M_U6M_CONS_LIV|VL_RAZ_MED_U6M_U12M_CONS_LIV|VL_RAZ_MED_U3M_U6M_CONS_ELE|VL_RAZ_MED_U6M_U12M_CONS_ELE|VL_RAZ_MED_U3M_U6M_CONS_ROU|VL_RAZ_MED_U6M_U12M_CONS_ROU|PK_DATREF|PK_DAT_PROC|
+--------+---------+-------------------+---------------+-------------+------------+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------+-----------+
|      21|        F|               1331|              1|Intermediário|           1|         1|       1976.56|        116.27|        199.39|          5.39|              226.73|              113.37|               57.29|              169.44|                   57.29|                   57.29|                    57.29|                   57.29|                   57.29|                    57.29|                   57.29|                   57.29|                    57.29|               351.26|                87.81|                 9.84|               187.82|                     NULL|                   187.82|                    187.82|                     NULL|                   187.82|                    187.82|                     NULL|                   187.82|                    187.82|            551.06|            183.69|            169.11|            193.01|                193.01|                193.01|                 183.69|                193.01|                193.01|                 169.11|                193.01|                193.01|                 193.01|                 396.72|                 132.24|                  76.91|                  160.0|                     118.45|                     118.45|                      132.24|                      76.91|                      76.91|                       76.91|                      160.0|                      160.0|                       160.0|            450.79|             90.16|              5.39|            199.39|                  96.4|                 66.07|                   99.4|                 24.12|                  5.39|                   5.39|                168.69|                168.69|                 199.39|                        1.0|                         1.0|                       NULL|                         1.0|                        1.0|                        1.05|                        1.0|                         0.9|                       1.46|                        0.66|   202408| 2024-08-30|
|      21|        M|               1160|              0|Intermediário|           0|         2|        1017.8|        101.78|        192.63|         47.58|              275.47|               91.82|               57.35|               111.9|                   57.35|                   57.35|                    84.62|                   57.35|                   57.35|                    57.35|                   57.35|                   57.35|                    111.9|               109.58|                54.79|                47.58|                 62.0|                    47.58|                    54.79|                     54.79|                    47.58|                    47.58|                     47.58|                    47.58|                     62.0|                      62.0|            340.59|            170.29|            147.96|            192.63|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                 292.16|                  97.39|                  69.05|                 123.23|                       NULL|                      69.05|                       69.05|                       NULL|                      69.05|                       69.05|                       NULL|                      69.05|                       69.05|               0.0|              NULL|              NULL|              NULL|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                        1.0|                        0.68|                       0.87|                         1.0|                       NULL|                        NULL|                       NULL|                         1.0|                       NULL|                        NULL|   202408| 2024-08-30|
|      62|        M|                454|              1|       Básico|           0|         3|        997.81|        110.87|        191.09|         41.91|              327.09|              163.55|              162.82|              164.27|                  164.27|                  164.27|                   164.27|                  164.27|                  164.27|                   164.27|                  164.27|                  164.27|                   164.27|               247.52|               123.76|                56.43|               191.09|                     NULL|                     NULL|                      NULL|                     NULL|                     NULL|                      NULL|                     NULL|                     NULL|                      NULL|            105.81|             52.91|             41.91|              63.9|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                 317.38|                 105.79|                  46.79|                 173.16|                      97.44|                      97.44|                      105.79|                      97.44|                      97.44|                       46.79|                      97.44|                      97.44|                      173.16|               0.0|              NULL|              NULL|              NULL|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                        1.0|                         1.0|                       NULL|                        NULL|                       NULL|                        NULL|                        1.0|                        0.92|                       NULL|                        NULL|   202408| 2024-08-30|
+--------+---------+-------------------+---------------+-------------+------------+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------+-----------+
only showing top 3 rows
</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#F3F2EE">
<h2 id="Salvando-tabela-no-diret%C3%B3rio-do-Drive"><font color="#CC403E" face="Segoe Print" size="4"><strong>Salvando tabela no diretório do Drive</strong></font><a class="anchor-link" href="#Salvando-tabela-no-diret%C3%B3rio-do-Drive">¶</a></h2><font color="#66666" face="Segoe Print" size="3">
</font></div>
<div class="cell">
<div class="code_cell">
<pre>abt.write.partitionBy("PK_DATREF").mode("overwrite").parquet(caminho+"/sinteticos/ABT")</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#F3F2EE">
<h2 id="Gerando-amostra-aleat%C3%B3ria"><font color="#CC403E" face="Segoe Print" size="4"><strong>Gerando amostra aleatória</strong></font><a class="anchor-link" href="#Gerando-amostra-aleat%C3%B3ria">¶</a></h2><font color="#66666" face="Segoe Print" size="3">
</font></div>
<div class="cell">
<div class="code_cell">
<pre># Amostra sem reposição: 10% da população total
sampled_abt = abt.sample(False, 0.1)
sampled_abt.count()</pre>
</div>
<div class="output">
<pre>89</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>sampled_abt.show(5)</pre>
</div>
<div class="output">
<pre>+--------+---------+-------------------+---------------+-------------+------------+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------+-----------+
|VL_IDADE|NM_GENERO|QT_DIAS_DESDE_INSCR|FL_USOU_SUPORTE|     NM_PLANO|TARGET_CHURN|ID_CLIENTE|VL_TOT_CONSUMO|VL_MED_CONSUMO|VL_MAX_CONSUMO|VL_MIN_CONSUMO|VL_TOT_CONS_ESPORTES|VL_MED_CONS_ESPORTES|VL_MIN_CONS_ESPORTES|VL_MAX_CONS_ESPORTES|VL_MED_U3M_CONS_ESPORTES|VL_MED_U6M_CONS_ESPORTES|VL_MED_U12M_CONS_ESPORTES|VL_MIN_U3M_CONS_ESPORTES|VL_MIN_U6M_CONS_ESPORTES|VL_MIN_U12M_CONS_ESPORTES|VL_MAX_U3M_CONS_ESPORTES|VL_MAX_U6M_CONS_ESPORTES|VL_MAX_U12M_CONS_ESPORTES|VL_TOT_CONS_ALIMENTOS|VL_MED_CONS_ALIMENTOS|VL_MIN_CONS_ALIMENTOS|VL_MAX_CONS_ALIMENTOS|VL_MED_U3M_CONS_ALIMENTOS|VL_MED_U6M_CONS_ALIMENTOS|VL_MED_U12M_CONS_ALIMENTOS|VL_MIN_U3M_CONS_ALIMENTOS|VL_MIN_U6M_CONS_ALIMENTOS|VL_MIN_U12M_CONS_ALIMENTOS|VL_MAX_U3M_CONS_ALIMENTOS|VL_MAX_U6M_CONS_ALIMENTOS|VL_MAX_U12M_CONS_ALIMENTOS|VL_TOT_CONS_LIVROS|VL_MED_CONS_LIVROS|VL_MIN_CONS_LIVROS|VL_MAX_CONS_LIVROS|VL_MED_U3M_CONS_LIVROS|VL_MED_U6M_CONS_LIVROS|VL_MED_U12M_CONS_LIVROS|VL_MIN_U3M_CONS_LIVROS|VL_MIN_U6M_CONS_LIVROS|VL_MIN_U12M_CONS_LIVROS|VL_MAX_U3M_CONS_LIVROS|VL_MAX_U6M_CONS_LIVROS|VL_MAX_U12M_CONS_LIVROS|VL_TOT_CONS_ELETRONICOS|VL_MED_CONS_ELETRONICOS|VL_MIN_CONS_ELETRONICOS|VL_MAX_CONS_ELETRONICOS|VL_MED_U3M_CONS_ELETRONICOS|VL_MED_U6M_CONS_ELETRONICOS|VL_MED_U12M_CONS_ELETRONICOS|VL_MIN_U3M_CONS_ELETRONICOS|VL_MIN_U6M_CONS_ELETRONICOS|VL_MIN_U12M_CONS_ELETRONICOS|VL_MAX_U3M_CONS_ELETRONICOS|VL_MAX_U6M_CONS_ELETRONICOS|VL_MAX_U12M_CONS_ELETRONICOS|VL_TOT_CONS_ROUPAS|VL_MED_CONS_ROUPAS|VL_MIN_CONS_ROUPAS|VL_MAX_CONS_ROUPAS|VL_MED_U3M_CONS_ROUPAS|VL_MED_U6M_CONS_ROUPAS|VL_MED_U12M_CONS_ROUPAS|VL_MIN_U3M_CONS_ROUPAS|VL_MIN_U6M_CONS_ROUPAS|VL_MIN_U12M_CONS_ROUPAS|VL_MAX_U3M_CONS_ROUPAS|VL_MAX_U6M_CONS_ROUPAS|VL_MAX_U12M_CONS_ROUPAS|VL_RAZ_MED_U3M_U6M_CONS_ESP|VL_RAZ_MED_U6M_U12M_CONS_ESP|VL_RAZ_MED_U3M_U6M_CONS_ALI|VL_RAZ_MED_U6M_U12M_CONS_ALI|VL_RAZ_MED_U3M_U6M_CONS_LIV|VL_RAZ_MED_U6M_U12M_CONS_LIV|VL_RAZ_MED_U3M_U6M_CONS_ELE|VL_RAZ_MED_U6M_U12M_CONS_ELE|VL_RAZ_MED_U3M_U6M_CONS_ROU|VL_RAZ_MED_U6M_U12M_CONS_ROU|PK_DATREF|PK_DAT_PROC|
+--------+---------+-------------------+---------------+-------------+------------+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------+-----------+
|      25|        F|               1565|              0|     Avançado|           1|        21|        656.54|        109.42|        153.51|         21.73|              221.99|               111.0|              105.66|              116.34|                    NULL|                    NULL|                     NULL|                    NULL|                    NULL|                     NULL|                    NULL|                    NULL|                     NULL|                  0.0|                 NULL|                 NULL|                 NULL|                     NULL|                     NULL|                      NULL|                     NULL|                     NULL|                      NULL|                     NULL|                     NULL|                      NULL|            156.51|             78.26|             21.73|            134.78|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                 153.51|                 153.51|                 153.51|                 153.51|                     153.51|                     153.51|                      153.51|                     153.51|                     153.51|                      153.51|                     153.51|                     153.51|                      153.51|            124.53|            124.53|            124.53|            124.53|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                       NULL|                        NULL|                       NULL|                        NULL|                       NULL|                        NULL|                        1.0|                         1.0|                       NULL|                        NULL|   202408| 2024-08-30|
|      25|        M|               1797|              1|       Básico|           0|        25|       1251.64|        113.79|        178.72|          6.86|               162.2|                81.1|                6.86|              155.35|                    6.86|                    6.86|                     6.86|                    6.86|                    6.86|                     6.86|                    6.86|                    6.86|                     6.86|               345.98|               172.99|               168.49|               177.49|                   177.49|                   177.49|                    177.49|                   177.49|                   177.49|                    177.49|                   177.49|                   177.49|                    177.49|            313.64|            104.55|              41.1|            178.72|                  NULL|                 93.82|                  67.46|                  NULL|                 93.82|                   41.1|                  NULL|                 93.82|                  93.82|                  87.58|                  87.58|                  87.58|                  87.58|                       NULL|                       NULL|                        NULL|                       NULL|                       NULL|                        NULL|                       NULL|                       NULL|                        NULL|            342.24|            114.08|             41.53|            170.33|                  NULL|                  NULL|                 130.38|                  NULL|                  NULL|                 130.38|                  NULL|                  NULL|                 130.38|                        1.0|                         1.0|                        1.0|                         1.0|                       NULL|                        1.39|                       NULL|                        NULL|                       NULL|                        NULL|   202408| 2024-08-30|
|      22|        M|                480|              1|       Básico|           1|        32|       1367.86|        124.35|        190.44|         53.58|              273.06|               91.02|                86.7|               95.51|                    86.7|                    91.1|                     91.1|                    86.7|                    86.7|                     86.7|                    86.7|                   95.51|                    95.51|               161.43|               161.43|               161.43|               161.43|                     NULL|                     NULL|                    161.43|                     NULL|                     NULL|                    161.43|                     NULL|                     NULL|                    161.43|            717.83|            179.46|            173.91|            190.44|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                  53.58|                  53.58|                  53.58|                  53.58|                      53.58|                      53.58|                       53.58|                      53.58|                      53.58|                       53.58|                      53.58|                      53.58|                       53.58|            161.96|             80.98|             72.91|             89.04|                  NULL|                 72.91|                  72.91|                  NULL|                 72.91|                  72.91|                  NULL|                 72.91|                  72.91|                       0.95|                         1.0|                       NULL|                        NULL|                       NULL|                        NULL|                        1.0|                         1.0|                       NULL|                         1.0|   202408| 2024-08-30|
|      37|        M|                995|              0|Intermediário|           0|        33|        645.65|         92.24|        168.44|         26.09|              211.56|              105.78|               43.11|              168.44|                    NULL|                    NULL|                     NULL|                    NULL|                    NULL|                     NULL|                    NULL|                    NULL|                     NULL|                53.57|                53.57|                53.57|                53.57|                     NULL|                     NULL|                      NULL|                     NULL|                     NULL|                      NULL|                     NULL|                     NULL|                      NULL|            105.24|            105.24|            105.24|            105.24|                105.24|                105.24|                 105.24|                105.24|                105.24|                 105.24|                105.24|                105.24|                 105.24|                  26.09|                  26.09|                  26.09|                  26.09|                       NULL|                       NULL|                        NULL|                       NULL|                       NULL|                        NULL|                       NULL|                       NULL|                        NULL|            249.19|             124.6|            107.82|            141.37|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                       NULL|                        NULL|                       NULL|                        NULL|                        1.0|                         1.0|                       NULL|                        NULL|                       NULL|                        NULL|   202408| 2024-08-30|
|      28|        F|                934|              0|Intermediário|           1|        40|         52.02|         26.01|         40.31|         11.71|                 0.0|                NULL|                NULL|                NULL|                    NULL|                    NULL|                     NULL|                    NULL|                    NULL|                     NULL|                    NULL|                    NULL|                     NULL|                  0.0|                 NULL|                 NULL|                 NULL|                     NULL|                     NULL|                      NULL|                     NULL|                     NULL|                      NULL|                     NULL|                     NULL|                      NULL|             11.71|             11.71|             11.71|             11.71|                  NULL|                  NULL|                  11.71|                  NULL|                  NULL|                  11.71|                  NULL|                  NULL|                  11.71|                    0.0|                   NULL|                   NULL|                   NULL|                       NULL|                       NULL|                        NULL|                       NULL|                       NULL|                        NULL|                       NULL|                       NULL|                        NULL|             40.31|             40.31|             40.31|             40.31|                 40.31|                 40.31|                  40.31|                 40.31|                 40.31|                  40.31|                 40.31|                 40.31|                  40.31|                       NULL|                        NULL|                       NULL|                        NULL|                       NULL|                        NULL|                       NULL|                        NULL|                        1.0|                         1.0|   202408| 2024-08-30|
+--------+---------+-------------------+---------------+-------------+------------+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------+-----------+
only showing top 5 rows

</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>+--------+---------+-------------------+---------------+-------------+------------+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------+-----------+
|VL_IDADE|NM_GENERO|QT_DIAS_DESDE_INSCR|FL_USOU_SUPORTE|     NM_PLANO|TARGET_CHURN|ID_CLIENTE|VL_TOT_CONSUMO|VL_MED_CONSUMO|VL_MAX_CONSUMO|VL_MIN_CONSUMO|VL_TOT_CONS_ESPORTES|VL_MED_CONS_ESPORTES|VL_MIN_CONS_ESPORTES|VL_MAX_CONS_ESPORTES|VL_MED_U3M_CONS_ESPORTES|VL_MED_U6M_CONS_ESPORTES|VL_MED_U12M_CONS_ESPORTES|VL_MIN_U3M_CONS_ESPORTES|VL_MIN_U6M_CONS_ESPORTES|VL_MIN_U12M_CONS_ESPORTES|VL_MAX_U3M_CONS_ESPORTES|VL_MAX_U6M_CONS_ESPORTES|VL_MAX_U12M_CONS_ESPORTES|VL_TOT_CONS_ALIMENTOS|VL_MED_CONS_ALIMENTOS|VL_MIN_CONS_ALIMENTOS|VL_MAX_CONS_ALIMENTOS|VL_MED_U3M_CONS_ALIMENTOS|VL_MED_U6M_CONS_ALIMENTOS|VL_MED_U12M_CONS_ALIMENTOS|VL_MIN_U3M_CONS_ALIMENTOS|VL_MIN_U6M_CONS_ALIMENTOS|VL_MIN_U12M_CONS_ALIMENTOS|VL_MAX_U3M_CONS_ALIMENTOS|VL_MAX_U6M_CONS_ALIMENTOS|VL_MAX_U12M_CONS_ALIMENTOS|VL_TOT_CONS_LIVROS|VL_MED_CONS_LIVROS|VL_MIN_CONS_LIVROS|VL_MAX_CONS_LIVROS|VL_MED_U3M_CONS_LIVROS|VL_MED_U6M_CONS_LIVROS|VL_MED_U12M_CONS_LIVROS|VL_MIN_U3M_CONS_LIVROS|VL_MIN_U6M_CONS_LIVROS|VL_MIN_U12M_CONS_LIVROS|VL_MAX_U3M_CONS_LIVROS|VL_MAX_U6M_CONS_LIVROS|VL_MAX_U12M_CONS_LIVROS|VL_TOT_CONS_ELETRONICOS|VL_MED_CONS_ELETRONICOS|VL_MIN_CONS_ELETRONICOS|VL_MAX_CONS_ELETRONICOS|VL_MED_U3M_CONS_ELETRONICOS|VL_MED_U6M_CONS_ELETRONICOS|VL_MED_U12M_CONS_ELETRONICOS|VL_MIN_U3M_CONS_ELETRONICOS|VL_MIN_U6M_CONS_ELETRONICOS|VL_MIN_U12M_CONS_ELETRONICOS|VL_MAX_U3M_CONS_ELETRONICOS|VL_MAX_U6M_CONS_ELETRONICOS|VL_MAX_U12M_CONS_ELETRONICOS|VL_TOT_CONS_ROUPAS|VL_MED_CONS_ROUPAS|VL_MIN_CONS_ROUPAS|VL_MAX_CONS_ROUPAS|VL_MED_U3M_CONS_ROUPAS|VL_MED_U6M_CONS_ROUPAS|VL_MED_U12M_CONS_ROUPAS|VL_MIN_U3M_CONS_ROUPAS|VL_MIN_U6M_CONS_ROUPAS|VL_MIN_U12M_CONS_ROUPAS|VL_MAX_U3M_CONS_ROUPAS|VL_MAX_U6M_CONS_ROUPAS|VL_MAX_U12M_CONS_ROUPAS|VL_RAZ_MED_U3M_U6M_CONS_ESP|VL_RAZ_MED_U6M_U12M_CONS_ESP|VL_RAZ_MED_U3M_U6M_CONS_ALI|VL_RAZ_MED_U6M_U12M_CONS_ALI|VL_RAZ_MED_U3M_U6M_CONS_LIV|VL_RAZ_MED_U6M_U12M_CONS_LIV|VL_RAZ_MED_U3M_U6M_CONS_ELE|VL_RAZ_MED_U6M_U12M_CONS_ELE|VL_RAZ_MED_U3M_U6M_CONS_ROU|VL_RAZ_MED_U6M_U12M_CONS_ROU|PK_DATREF|PK_DAT_PROC|
+--------+---------+-------------------+---------------+-------------+------------+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------+-----------+
|      25|        F|               1565|              0|     Avançado|           1|        21|        656.54|        109.42|        153.51|         21.73|              221.99|               111.0|              105.66|              116.34|                    NULL|                    NULL|                     NULL|                    NULL|                    NULL|                     NULL|                    NULL|                    NULL|                     NULL|                  0.0|                 NULL|                 NULL|                 NULL|                     NULL|                     NULL|                      NULL|                     NULL|                     NULL|                      NULL|                     NULL|                     NULL|                      NULL|            156.51|             78.26|             21.73|            134.78|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                 153.51|                 153.51|                 153.51|                 153.51|                     153.51|                     153.51|                      153.51|                     153.51|                     153.51|                      153.51|                     153.51|                     153.51|                      153.51|            124.53|            124.53|            124.53|            124.53|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                       NULL|                        NULL|                       NULL|                        NULL|                       NULL|                        NULL|                        1.0|                         1.0|                       NULL|                        NULL|   202408| 2024-08-30|
|      25|        M|               1797|              1|       Básico|           0|        25|       1251.64|        113.79|        178.72|          6.86|               162.2|                81.1|                6.86|              155.35|                    6.86|                    6.86|                     6.86|                    6.86|                    6.86|                     6.86|                    6.86|                    6.86|                     6.86|               345.98|               172.99|               168.49|               177.49|                   177.49|                   177.49|                    177.49|                   177.49|                   177.49|                    177.49|                   177.49|                   177.49|                    177.49|            313.64|            104.55|              41.1|            178.72|                  NULL|                 93.82|                  67.46|                  NULL|                 93.82|                   41.1|                  NULL|                 93.82|                  93.82|                  87.58|                  87.58|                  87.58|                  87.58|                       NULL|                       NULL|                        NULL|                       NULL|                       NULL|                        NULL|                       NULL|                       NULL|                        NULL|            342.24|            114.08|             41.53|            170.33|                  NULL|                  NULL|                 130.38|                  NULL|                  NULL|                 130.38|                  NULL|                  NULL|                 130.38|                        1.0|                         1.0|                        1.0|                         1.0|                       NULL|                        1.39|                       NULL|                        NULL|                       NULL|                        NULL|   202408| 2024-08-30|
|      22|        M|                480|              1|       Básico|           1|        32|       1367.86|        124.35|        190.44|         53.58|              273.06|               91.02|                86.7|               95.51|                    86.7|                    91.1|                     91.1|                    86.7|                    86.7|                     86.7|                    86.7|                   95.51|                    95.51|               161.43|               161.43|               161.43|               161.43|                     NULL|                     NULL|                    161.43|                     NULL|                     NULL|                    161.43|                     NULL|                     NULL|                    161.43|            717.83|            179.46|            173.91|            190.44|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                  53.58|                  53.58|                  53.58|                  53.58|                      53.58|                      53.58|                       53.58|                      53.58|                      53.58|                       53.58|                      53.58|                      53.58|                       53.58|            161.96|             80.98|             72.91|             89.04|                  NULL|                 72.91|                  72.91|                  NULL|                 72.91|                  72.91|                  NULL|                 72.91|                  72.91|                       0.95|                         1.0|                       NULL|                        NULL|                       NULL|                        NULL|                        1.0|                         1.0|                       NULL|                         1.0|   202408| 2024-08-30|
|      37|        M|                995|              0|Intermediário|           0|        33|        645.65|         92.24|        168.44|         26.09|              211.56|              105.78|               43.11|              168.44|                    NULL|                    NULL|                     NULL|                    NULL|                    NULL|                     NULL|                    NULL|                    NULL|                     NULL|                53.57|                53.57|                53.57|                53.57|                     NULL|                     NULL|                      NULL|                     NULL|                     NULL|                      NULL|                     NULL|                     NULL|                      NULL|            105.24|            105.24|            105.24|            105.24|                105.24|                105.24|                 105.24|                105.24|                105.24|                 105.24|                105.24|                105.24|                 105.24|                  26.09|                  26.09|                  26.09|                  26.09|                       NULL|                       NULL|                        NULL|                       NULL|                       NULL|                        NULL|                       NULL|                       NULL|                        NULL|            249.19|             124.6|            107.82|            141.37|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                  NULL|                  NULL|                   NULL|                       NULL|                        NULL|                       NULL|                        NULL|                        1.0|                         1.0|                       NULL|                        NULL|                       NULL|                        NULL|   202408| 2024-08-30|
|      28|        F|                934|              0|Intermediário|           1|        40|         52.02|         26.01|         40.31|         11.71|                 0.0|                NULL|                NULL|                NULL|                    NULL|                    NULL|                     NULL|                    NULL|                    NULL|                     NULL|                    NULL|                    NULL|                     NULL|                  0.0|                 NULL|                 NULL|                 NULL|                     NULL|                     NULL|                      NULL|                     NULL|                     NULL|                      NULL|                     NULL|                     NULL|                      NULL|             11.71|             11.71|             11.71|             11.71|                  NULL|                  NULL|                  11.71|                  NULL|                  NULL|                  11.71|                  NULL|                  NULL|                  11.71|                    0.0|                   NULL|                   NULL|                   NULL|                       NULL|                       NULL|                        NULL|                       NULL|                       NULL|                        NULL|                       NULL|                       NULL|                        NULL|             40.31|             40.31|             40.31|             40.31|                 40.31|                 40.31|                  40.31|                 40.31|                 40.31|                  40.31|                 40.31|                 40.31|                  40.31|                       NULL|                        NULL|                       NULL|                        NULL|                       NULL|                        NULL|                       NULL|                        NULL|                        1.0|                         1.0|   202408| 2024-08-30|
+--------+---------+-------------------+---------------+-------------+------------+----------+--------------+--------------+--------------+--------------+--------------------+--------------------+--------------------+--------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+------------------------+------------------------+-------------------------+---------------------+---------------------+---------------------+---------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+-------------------------+-------------------------+--------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+---------------------------+---------------------------+----------------------------+------------------+------------------+------------------+------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+----------------------+----------------------+-----------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------------------------+----------------------------+---------+-----------+
only showing top 5 rows

</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>abt.count()</pre>
</div>
<div class="output">
<pre>1000</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>%reload_ext watermark
%watermark -a "Roberto Soares - LfLngLrnng"</pre>
</div>
<div class="output">
<pre>Author: Roberto Soares - LfLngLrnng

</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>%watermark -v -m</pre>
</div>
<div class="output">
<pre>Python implementation: CPython
Python version       : 3.10.14
IPython version      : 8.25.0

Compiler    : MSC v.1916 64 bit (AMD64)
OS          : Windows
Release     : 10
Machine     : AMD64
Processor   : Intel64 Family 6 Model 158 Stepping 9, GenuineIntel
CPU cores   : 4
Architecture: 64bit

</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre>%watermark --iversions</pre>
</div>
<div class="output">
<pre>sys    : 3.10.14 | packaged by Anaconda, Inc. | (main, May  6 2024, 19:44:50) [MSC v.1916 64 bit (AMD64)]
numpy  : 2.0.1
pyspark: 3.5.2
decimal: 1.70

</pre>
</div>
</div>
<div class="cell">
<div style="background-color:#F3F2EE">
<p><font color="#CC403E" face="Segoe Print" size="5"><strong>Fim</strong></font></p>
<font color="#66666" face="Segoe Print" size="3">
</font></div>
<div class="cell">
<div class="code_cell">
<pre>!jupyter nbconvert --to html --template=D:/anaconda3/envs/spark-pod-env/share/jupyter/nbconvert/templates/compatibility/mytemplate.tpl A009b_Feature_Engineering_ABT_SparkSQL.ipynb</pre>
</div>
<div class="output">
<pre>[NbConvertApp] Converting notebook A009b_Feature_Engineering_ABT_SparkSQL.ipynb to html
[NbConvertApp] Writing 223470 bytes to A009b_Feature_Engineering_ABT_SparkSQL.html
</pre>
</div>
</div>
<div class="cell">
<div class="code_cell">
<pre></pre>
</div>
</div>
</div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></body>
</html>
